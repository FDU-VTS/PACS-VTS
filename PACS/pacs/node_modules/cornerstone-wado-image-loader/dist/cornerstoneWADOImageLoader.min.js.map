{"version":3,"sources":["webpack://[name]/webpack/universalModuleDefinition","webpack://[name]/webpack/bootstrap","webpack://[name]/./shared/getMinMax.js","webpack://[name]/./shared/decoders/decodeJPEGLS.js","webpack://[name]/./shared/decoders/decodeJPEG2000.js","webpack://[name]/./version.js","webpack://[name]/./shared/calculateMinMax.js","webpack://[name]/./shared/decoders/decodeLittleEndian.js","webpack://[name]/./shared/decoders/decodeBigEndian.js","webpack://[name]/./shared/decoders/decodeRLE.js","webpack://[name]/./shared/decoders/decodeJPEGBaseline.js","webpack://[name]/./shared/decoders/decodeJPEGLossless.js","webpack://[name]/./shared/decodeImageFrame.js","webpack://[name]/./imageLoader/colorSpaceConverters/convertRGBColorByPixel.js","webpack://[name]/./imageLoader/colorSpaceConverters/convertRGBColorByPlane.js","webpack://[name]/./imageLoader/colorSpaceConverters/convertYBRFullByPixel.js","webpack://[name]/./imageLoader/colorSpaceConverters/convertYBRFullByPlane.js","webpack://[name]/./imageLoader/colorSpaceConverters/convertPALETTECOLOR.js","webpack://[name]/./imageLoader/wadouri/metaData/getImagePixelModule.js","webpack://[name]/./imageLoader/wadouri/metaData/getLUTs.js","webpack://[name]/./imageLoader/wadouri/metaData/getModalityLUTOutputPixelRepresentation.js","webpack://[name]/./imageLoader/wadouri/metaData/getNumberValues.js","webpack://[name]/./imageLoader/wadors/metaData/getValue.js","webpack://[name]/./imageLoader/wadors/metaData/getNumberString.js","webpack://[name]/./imageLoader/wadors/metaData/getNumberValue.js","webpack://[name]/./imageLoader/wadors/metaData/getNumberValues.js","webpack://[name]/./imageLoader/wadors/metaDataManager.js","webpack://[name]/./imageLoader/wadors/metaData/metaDataProvider.js","webpack://[name]/./imageLoader/wadors/findIndexOfString.js","webpack://[name]/./imageLoader/internal/options.js","webpack://[name]/./imageLoader/internal/xhrRequest.js","webpack://[name]/./imageLoader/internal/index.js","webpack://[name]/./imageLoader/wadors/getPixelData.js","webpack://[name]/./imageLoader/getImageFrame.js","webpack://[name]/./imageLoader/webWorkerManager.js","webpack://[name]/./imageLoader/decodeJPEGBaseline8BitColor.js","webpack://[name]/./imageLoader/decodeImageFrame.js","webpack://[name]/./imageLoader/isColorImage.js","webpack://[name]/./imageLoader/convertColorSpace.js","webpack://[name]/./imageLoader/isJPEGBaseline8BitColor.js","webpack://[name]/./imageLoader/createImage.js","webpack://[name]/./imageLoader/wadors/loadImage.js","webpack://[name]/./imageLoader/wadors/index.js","webpack://[name]/./imageLoader/wadors/register.js","webpack://[name]/./imageLoader/registerLoaders.js","webpack://[name]/./externalModules.js","webpack://[name]/./imageLoader/wadouri/parseImageId.js","webpack://[name]/./imageLoader/wadouri/dataSetCacheManager.js","webpack://[name]/./imageLoader/wadouri/metaData/metaDataProvider.js","webpack://[name]/./imageLoader/wadouri/fileManager.js","webpack://[name]/./imageLoader/wadouri/getEncapsulatedImageFrame.js","webpack://[name]/./imageLoader/wadouri/unpackBinaryFrame.js","webpack://[name]/./imageLoader/wadouri/getUncompressedImageFrame.js","webpack://[name]/./imageLoader/wadouri/loadFileRequest.js","webpack://[name]/./imageLoader/wadouri/getPixelData.js","webpack://[name]/./imageLoader/wadouri/loadImage.js","webpack://[name]/./imageLoader/wadouri/register.js","webpack://[name]/./imageLoader/wadouri/index.js","webpack://[name]/./imageLoader/configure.js","webpack://[name]/./imageLoader/index.js"],"names":["root","factory","exports","module","define","amd","this","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","getMinMax","storedPixelData","storedPixel","min","max","numPixels","length","index","Math","charLS","initializeJPEGLS","CharLS","Error","_jpegls_decode","__webpack_exports__","decodeJPEGLS","imageFrame","pixelData","image","data","isSigned","dataPtr","_malloc","writeArrayToMemory","imagePtrPtr","imageSizePtr","widthPtr","heightPtr","bitsPerSamplePtr","stridePtr","allowedLossyErrorPtr","componentsPtr","interleaveModePtr","result","ccall","width","getValue","height","bitsPerSample","stride","components","allowedLossyError","interleaveMode","undefined","imagePtr","Uint8Array","set","HEAP8","buffer","Int16Array","HEAP16","Uint16Array","_free","jpegLSDecode","pixelRepresentation","concat","columns","rows","openJPEG","decodeOpenJpeg2000","bytesPerPixel","signed","imageSizeXPtr","imageSizeYPtr","imageSizeCompPtr","t0","Date","getTime","console","log","sx","sy","nbChannels","perf_timetodecode","src32","Int32Array","HEAP32","from","t1","decodeOpenJPEG","bitsAllocated","photometricInterpretation","initializeJPEG2000","decodeConfig","usePDFJS","OpenJPEG","_jp2_decode","decodeJPEG2000","options","arguments","jpxImage","JpxImage","parse","tileCount","tiles","items","decodeJpx","calculateMinMax","_getMinMax_js__WEBPACK_IMPORTED_MODULE_0__","strict","minMax","mustAssign","isNumber","smallestPixelValue","largestPixelValue","warn","numValue","decodeLittleEndian","arrayBuffer","offset","byteOffset","slice","Float32Array","decodeBigEndian","val","decodeRLE","planarConfiguration","frameData","frameSize","outFrame","ArrayBuffer","samplesPerPixel","header","DataView","Int8Array","out","outIndex","numSegments","getInt32","inIndex","maxIndex","endOfSegment","j","decode8Planar","decode8","highByte","decode16","decodeJPEGBaseline","JpegImage","jpeg","colorTransform","getData","getData16","decodeJPEGLossless","lossless","Decoder","byteOutput","decompressedData","decode","decodeImageFrame","transferSyntax","start","shouldShift","shift","bitsStored","end","decodeTimeInMS","convertRGBColorByPixel","rgbaBuffer","rgbIndex","rgbaIndex","convertRGBColorByPlane","rIndex","gIndex","bIndex","convertYBRFullByPixel","ybrIndex","y","cb","cr","convertYBRFullByPlane","yIndex","cbIndex","crIndex","convertLUTto8Bit","lut","numEntries","cleanedLUT","Uint8ClampedArray","convertPALETTECOLOR","rData","redPaletteColorLookupTableData","gData","greenPaletteColorLookupTableData","bData","bluePaletteColorLookupTableData","len","palIndex","redPaletteColorLookupTableDescriptor","rDataCleaned","gDataCleaned","bDataCleaned","getLutDescriptor","dataSet","tag","elements","uint16","getLutData","lutDataSet","lutDescriptor","lutData","byteArray","dataOffset","getImagePixelModule","imagePixelModule","string","highBit","pixelAspectRatio","int16","x00281101","greenPaletteColorLookupTableDescriptor","bluePaletteColorLookupTableDescriptor","numLutEntries","lutBitsAllocated","x00281201","populatePaletteColorLut","getLUT","numLUTEntries","id","firstValueMapped","numBitsPerEntry","getLUTs","lutSequence","luts","push","getModalityLUTOutputPixelRepresentation","sopClassUID","rescaleIntercept","floatString","rescaleSlope","x00283000","getNumberValues","minimumLength","values","valueAsString","split","parseFloat","element","defaultValue","Value","getNumberString","getNumberValue","imageIds","metaDataManager","add","imageId","metadata","remove","purge","metaDataProvider","type","dicomParser","external","metaData","modality","seriesInstanceUID","seriesNumber","studyInstanceUID","seriesDate","parseDA","seriesTime","parseTM","patientAge","patientSize","patientWeight","imageOrientationPatient","imagePositionPatient","pixelSpacing","columnPixelSpacing","rowPixelSpacing","rowCosines","columnCosines","frameOfReferenceUID","sliceThickness","sliceLocation","windowCenter","windowWidth","rescaleType","sopInstanceUID","radiopharmaceuticalInfo","radiopharmaceuticalStartTime","radionuclideTotalDose","radionuclideHalfLife","checkToken","token","endIndex","findIndexOfString","str","uint","charCodeAt","stringToUint8Array","beforeSend","imageCreated","useWebWorkers","setOptions","newOptions","assign","getOptions","xhrRequest","url","headers","params","cornerstone","Promise","resolve","reject","xhr","XMLHttpRequest","open","responseType","keys","forEach","setRequestHeader","deferred","onloadstart","event","eventData","triggerEvent","events","onloadend","onreadystatechange","readyState","status","response","onprogress","oProgress","total","percentComplete","loaded","lengthComputable","round","onerror","onabort","send","internal","getPixelData","uri","accept","then","imageFrameAsArrayBuffer","tokenIndex","String","fromCharCode","uint8ArrayToString","boundary","substr","findBoundary","contentType","trim","findContentType","getImageFrame","config","nextTaskId","tasks","webWorkers","defaultConfig","maxWebWorkers","navigator","hardwareConcurrency","startWebWorkersOnDemand","webWorkerPath","webWorkerTaskPaths","taskConfiguration","decodeTask","loadCodecsOnStartup","initializeCodecsOnStartup","codecsPath","statistics","numWebWorkers","numTasksQueued","numTasksExecuting","numTasksCompleted","totalTaskTimeInMS","totalTimeDelayedInMS","startTaskOnWebWorker","task","added","worker","postMessage","taskType","workerIndex","transferList","spawnWebWorker","handleMessageFromWorker","msg","Worker","addEventListener","initialize","configObject","webWorkerManager","loadWebWorkerTask","sourcePath","taskConfig","addTask","priority","promise","taskId","splice","getStatistics","setTaskPriority","cancelTask","reason","arrayBufferToString","binary","error","decodeURIComponent","escape","_error","URIError","binaryToString","apply","Array","decodeJPEGBaseline8BitColor","canvas","imgBlob","Blob","fileReader","FileReader","readAsBinaryString","readAsArrayBuffer","onload","img","Image","context","getContext","drawImage","imageData","getImageData","src","window","btoa","e","codecsInitialized","processDecodeTask","transferPixelData","loaderOptions","decodeArguments","decodedImageFrame","decodeImageFrameHandler","imageLoader_isColorImage","photoMetricInterpretation","convertRGB","convertColorSpace","isJPEGBaseline8BitColor","lastImageIdDrawn","createImage","document","createElement","decodePromise","imagePlaneModule","voiLutModule","modalityLutModule","sopCommonModule","isColorImage","isColorImageFn","createImageData","sopClassUid","color","intercept","invert","minPixelValue","maxPixelValue","sizeInBytes","slope","floatPixelData","results","floatMinMax","abs","intPixelData","rescaledPixel","floor","convertToIntPixelData","getCanvas","putImageData","modalityLUTSequence","modalityLUT","voiLUTSequence","voiLUT","maxVoi","minVoi","loadImage","substring","defaultTransferSyntax","parameters","parameter","parameterValues","replace","defaultTransferSyntaxByType","image/jpeg","image/x-dicom-rle","image/x-jls","image/jp2","image/jpx","getTransferSyntaxForContentType","loadTimeInMS","catch","cancelFn","wadors","register","registerImageLoader","addProvider","registerLoaders","wadouri","cs","dp","parseImageId","frame","firstColonIndex","indexOf","frameIndex","frameStr","parseInt","scheme","cacheSizeInBytes","loadedDataSets","promises","getInfo","numberOfDataSetsCached","dataSetCacheManager","isLoaded","load","loadRequest","cacheCount","loadDICOMPromise","dicomPart10AsArrayBuffer","parseDicom","action","cacheInfo","unload","parsedImageId","intString","modalityLUTOutputPixelRepresentation","x00283010","x00540016","firstRadiopharmaceuticalInfoDataSet","files","fileManager","file","fileIndex","getEncapsulatedImageFrame","x7fe00010","basicOffsetTable","readEncapsulatedImageFrame","fragments","readEncapsulatedPixelDataFromFragments","createJPEGBasicOffsetTable","unpackBinaryFrame","frameOffset","pixelsPerFrame","byte","bitPos","getUncompressedImageFrame","pixelDataElement","x7fe00008","pixelDataOffset","loadFileRequest","target","encapsulatedPixelData","loadImageFromPromise","dataSetPromise","sharedCacheKey","callbacks","imageLoadObject","loadEnd","imagePromise","decache","totalTimeInMS","imageDoneCallback","getLoaderForScheme","loader","loadImageFromDataSet","configure","imageLoader_configure","imageLoader_createImage","imageLoader_decodeImageFrame","imageLoader_decodeJPEGBaseline8BitColor","imageLoader_getImageFrame","imageLoader_isJPEGBaseline8BitColor","version","externalModules","cornerstoneWADOImageLoader"],"mappings":"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","file":"cornerstoneWADOImageLoader.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"cornerstoneWADOImageLoader\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"cornerstoneWADOImageLoader\"] = factory();\n\telse\n\t\troot[\"cornerstoneWADOImageLoader\"] = factory();\n})(this, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 6);\n","/**\r\n * Calculate the minimum and maximum values in an Array\r\n *\r\n * @param {Number[]} storedPixelData\r\n * @return {{min: Number, max: Number}}\r\n */\r\nfunction getMinMax (storedPixelData) {\r\n  // we always calculate the min max values since they are not always\r\n  // present in DICOM and we don't want to trust them anyway as cornerstone\r\n  // depends on us providing reliable values for these\r\n  let min = storedPixelData[0];\r\n  let max = storedPixelData[0];\r\n  let storedPixel;\r\n  const numPixels = storedPixelData.length;\r\n\r\n  for (let index = 1; index < numPixels; index++) {\r\n    storedPixel = storedPixelData[index];\r\n    min = Math.min(min, storedPixel);\r\n    max = Math.max(max, storedPixel);\r\n  }\r\n\r\n  return {\r\n    min,\r\n    max\r\n  };\r\n}\r\n\r\nexport default getMinMax;\r\n","let charLS;\r\n\r\nfunction jpegLSDecode (data, isSigned) {\r\n  // prepare input parameters\r\n  const dataPtr = charLS._malloc(data.length);\r\n\r\n  charLS.writeArrayToMemory(data, dataPtr);\r\n\r\n  // prepare output parameters\r\n  const imagePtrPtr = charLS._malloc(4);\r\n  const imageSizePtr = charLS._malloc(4);\r\n  const widthPtr = charLS._malloc(4);\r\n  const heightPtr = charLS._malloc(4);\r\n  const bitsPerSamplePtr = charLS._malloc(4);\r\n  const stridePtr = charLS._malloc(4);\r\n  const allowedLossyErrorPtr = charLS._malloc(4);\r\n  const componentsPtr = charLS._malloc(4);\r\n  const interleaveModePtr = charLS._malloc(4);\r\n\r\n  // Decode the image\r\n  const result = charLS.ccall(\r\n    'jpegls_decode',\r\n    'number',\r\n    ['number', 'number', 'number', 'number', 'number', 'number', 'number', 'number', 'number', 'number', 'number'],\r\n    [dataPtr, data.length, imagePtrPtr, imageSizePtr, widthPtr, heightPtr, bitsPerSamplePtr, stridePtr, componentsPtr, allowedLossyErrorPtr, interleaveModePtr]\r\n  );\r\n\r\n  // Extract result values into object\r\n  const image = {\r\n    result,\r\n    width: charLS.getValue(widthPtr, 'i32'),\r\n    height: charLS.getValue(heightPtr, 'i32'),\r\n    bitsPerSample: charLS.getValue(bitsPerSamplePtr, 'i32'),\r\n    stride: charLS.getValue(stridePtr, 'i32'),\r\n    components: charLS.getValue(componentsPtr, 'i32'),\r\n    allowedLossyError: charLS.getValue(allowedLossyErrorPtr, 'i32'),\r\n    interleaveMode: charLS.getValue(interleaveModePtr, 'i32'),\r\n    pixelData: undefined\r\n  };\r\n\r\n  // Copy image from emscripten heap into appropriate array buffer type\r\n  const imagePtr = charLS.getValue(imagePtrPtr, '*');\r\n\r\n  if (image.bitsPerSample <= 8) {\r\n    image.pixelData = new Uint8Array(image.width * image.height * image.components);\r\n    image.pixelData.set(new Uint8Array(charLS.HEAP8.buffer, imagePtr, image.pixelData.length));\r\n  } else if (isSigned) {\r\n    image.pixelData = new Int16Array(image.width * image.height * image.components);\r\n    image.pixelData.set(new Int16Array(charLS.HEAP16.buffer, imagePtr, image.pixelData.length));\r\n  } else {\r\n    image.pixelData = new Uint16Array(image.width * image.height * image.components);\r\n    image.pixelData.set(new Uint16Array(charLS.HEAP16.buffer, imagePtr, image.pixelData.length));\r\n  }\r\n\r\n  // free memory and return image object\r\n  charLS._free(dataPtr);\r\n  charLS._free(imagePtr);\r\n  charLS._free(imagePtrPtr);\r\n  charLS._free(imageSizePtr);\r\n  charLS._free(widthPtr);\r\n  charLS._free(heightPtr);\r\n  charLS._free(bitsPerSamplePtr);\r\n  charLS._free(stridePtr);\r\n  charLS._free(componentsPtr);\r\n  charLS._free(interleaveModePtr);\r\n\r\n  return image;\r\n}\r\n\r\nfunction initializeJPEGLS () {\r\n  // check to make sure codec is loaded\r\n  if (typeof CharLS === 'undefined') {\r\n    throw new Error('No JPEG-LS decoder loaded');\r\n  }\r\n\r\n  // Try to initialize CharLS\r\n  // CharLS https://github.com/cornerstonejs/charls\r\n  if (!charLS) {\r\n    charLS = CharLS();\r\n    if (!charLS || !charLS._jpegls_decode) {\r\n      throw new Error('JPEG-LS failed to initialize');\r\n    }\r\n  }\r\n\r\n}\r\n\r\nfunction decodeJPEGLS (imageFrame, pixelData) {\r\n  initializeJPEGLS();\r\n\r\n  const image = jpegLSDecode(pixelData, imageFrame.pixelRepresentation === 1);\r\n\r\n  // throw error if not success or too much data\r\n  if (image.result !== 0 && image.result !== 6) {\r\n    throw new Error(`JPEG-LS decoder failed to decode frame (error code ${image.result})`);\r\n  }\r\n\r\n  imageFrame.columns = image.width;\r\n  imageFrame.rows = image.height;\r\n  imageFrame.pixelData = image.pixelData;\r\n\r\n  return imageFrame;\r\n}\r\n\r\nexport default decodeJPEGLS;\r\nexport { initializeJPEGLS };\r\n","function decodeJpx (imageFrame, pixelData) {\r\n  const jpxImage = new JpxImage();\r\n\r\n  jpxImage.parse(pixelData);\r\n\r\n  const tileCount = jpxImage.tiles.length;\r\n\r\n  if (tileCount !== 1) {\r\n    throw new Error(`JPEG2000 decoder returned a tileCount of ${tileCount}, when 1 is expected`);\r\n  }\r\n\r\n  imageFrame.columns = jpxImage.width;\r\n  imageFrame.rows = jpxImage.height;\r\n  imageFrame.pixelData = jpxImage.tiles[0].items;\r\n\r\n  return imageFrame;\r\n}\r\n\r\nlet openJPEG;\r\n\r\nfunction decodeOpenJPEG (data, bytesPerPixel, signed) {\r\n  const dataPtr = openJPEG._malloc(data.length);\r\n\r\n  openJPEG.writeArrayToMemory(data, dataPtr);\r\n\r\n  // create param outpout\r\n  const imagePtrPtr = openJPEG._malloc(4);\r\n  const imageSizePtr = openJPEG._malloc(4);\r\n  const imageSizeXPtr = openJPEG._malloc(4);\r\n  const imageSizeYPtr = openJPEG._malloc(4);\r\n  const imageSizeCompPtr = openJPEG._malloc(4);\r\n\r\n  const t0 = new Date().getTime();\r\n  const ret = openJPEG.ccall('jp2_decode', 'number', ['number', 'number', 'number', 'number', 'number', 'number', 'number'],\r\n    [dataPtr, data.length, imagePtrPtr, imageSizePtr, imageSizeXPtr, imageSizeYPtr, imageSizeCompPtr]);\r\n  // add num vomp..etc\r\n\r\n  if (ret !== 0) {\r\n    console.log('[opj_decode] decoding failed!');\r\n    openJPEG._free(dataPtr);\r\n    openJPEG._free(openJPEG.getValue(imagePtrPtr, '*'));\r\n    openJPEG._free(imageSizeXPtr);\r\n    openJPEG._free(imageSizeYPtr);\r\n    openJPEG._free(imageSizePtr);\r\n    openJPEG._free(imageSizeCompPtr);\r\n\r\n    return;\r\n  }\r\n\r\n  const imagePtr = openJPEG.getValue(imagePtrPtr, '*');\r\n\r\n  const image = {\r\n    length: openJPEG.getValue(imageSizePtr, 'i32'),\r\n    sx: openJPEG.getValue(imageSizeXPtr, 'i32'),\r\n    sy: openJPEG.getValue(imageSizeYPtr, 'i32'),\r\n    nbChannels: openJPEG.getValue(imageSizeCompPtr, 'i32'), // hard coded for now\r\n    perf_timetodecode: undefined,\r\n    pixelData: undefined\r\n  };\r\n\r\n  // Copy the data from the EMSCRIPTEN heap into the correct type array\r\n  const length = image.sx * image.sy * image.nbChannels;\r\n  const src32 = new Int32Array(openJPEG.HEAP32.buffer, imagePtr, length);\r\n\r\n  if (bytesPerPixel === 1) {\r\n    if (Uint8Array.from) {\r\n      image.pixelData = Uint8Array.from(src32);\r\n    } else {\r\n      image.pixelData = new Uint8Array(length);\r\n      for (let i = 0; i < length; i++) {\r\n        image.pixelData[i] = src32[i];\r\n      }\r\n    }\r\n  } else if (signed) {\r\n    if (Int16Array.from) {\r\n      image.pixelData = Int16Array.from(src32);\r\n    } else {\r\n      image.pixelData = new Int16Array(length);\r\n      for (let i = 0; i < length; i++) {\r\n        image.pixelData[i] = src32[i];\r\n      }\r\n    }\r\n  } else if (Uint16Array.from) {\r\n    image.pixelData = Uint16Array.from(src32);\r\n  } else {\r\n    image.pixelData = new Uint16Array(length);\r\n    for (let i = 0; i < length; i++) {\r\n      image.pixelData[i] = src32[i];\r\n    }\r\n  }\r\n\r\n  const t1 = new Date().getTime();\r\n\r\n  image.perf_timetodecode = t1 - t0;\r\n\r\n  // free\r\n  openJPEG._free(dataPtr);\r\n  openJPEG._free(imagePtrPtr);\r\n  openJPEG._free(imagePtr);\r\n  openJPEG._free(imageSizePtr);\r\n  openJPEG._free(imageSizeXPtr);\r\n  openJPEG._free(imageSizeYPtr);\r\n  openJPEG._free(imageSizeCompPtr);\r\n\r\n  return image;\r\n}\r\n\r\nfunction decodeOpenJpeg2000 (imageFrame, pixelData) {\r\n  const bytesPerPixel = imageFrame.bitsAllocated <= 8 ? 1 : 2;\r\n  const signed = imageFrame.pixelRepresentation === 1;\r\n\r\n  const image = decodeOpenJPEG(pixelData, bytesPerPixel, signed);\r\n\r\n  imageFrame.columns = image.sx;\r\n  imageFrame.rows = image.sy;\r\n  imageFrame.pixelData = image.pixelData;\r\n  if (image.nbChannels > 1) {\r\n    imageFrame.photometricInterpretation = 'RGB';\r\n  }\r\n\r\n  return imageFrame;\r\n}\r\n\r\nfunction initializeJPEG2000 (decodeConfig) {\r\n  // check to make sure codec is loaded\r\n  if (!decodeConfig.usePDFJS) {\r\n    if (typeof OpenJPEG === 'undefined') {\r\n      throw new Error('OpenJPEG decoder not loaded');\r\n    }\r\n  }\r\n\r\n  if (!openJPEG) {\r\n    openJPEG = OpenJPEG();\r\n    if (!openJPEG || !openJPEG._jp2_decode) {\r\n      throw new Error('OpenJPEG failed to initialize');\r\n    }\r\n  }\r\n}\r\n\r\nfunction decodeJPEG2000 (imageFrame, pixelData, decodeConfig, options = {}) {\r\n  initializeJPEG2000(decodeConfig);\r\n\r\n  if (options.usePDFJS || decodeConfig.usePDFJS) {\r\n    // OHIF image-JPEG2000 https://github.com/OHIF/image-JPEG2000\r\n    // console.log('PDFJS')\r\n    return decodeJpx(imageFrame, pixelData);\r\n  }\r\n\r\n  // OpenJPEG2000 https://github.com/jpambrun/openjpeg\r\n  // console.log('OpenJPEG')\r\n  return decodeOpenJpeg2000(imageFrame, pixelData);\r\n}\r\n\r\nexport default decodeJPEG2000;\r\nexport { initializeJPEG2000 };\r\n","export default '2.2.4';\n","import getMinMax from './getMinMax.js';\r\n\r\n/**\r\n * Check the minimum and maximum values in the imageFrame pixel data\r\n * match with the provided smallestPixelValue and largestPixelValue metaData.\r\n *\r\n * If 'strict' is true, log to the console a warning if these values do not match.\r\n * Otherwise, correct them automatically.\r\n *\r\n * @param {Object} imageFrame\r\n * @param {Boolean} strict If 'strict' is true, log to the console a warning if these values do not match.\r\n * Otherwise, correct them automatically.Default is true.\r\n */\r\nexport default function calculateMinMax (imageFrame, strict = true) {\r\n  const minMax = getMinMax(imageFrame.pixelData);\r\n  const mustAssign = !(isNumber(imageFrame.smallestPixelValue) && isNumber(imageFrame.largestPixelValue));\r\n\r\n\r\n  if (strict === true && !mustAssign) {\r\n    if (imageFrame.smallestPixelValue !== minMax.min) {\r\n      console.warn('Image smallestPixelValue tag is incorrect. Rendering performance will suffer considerably.');\r\n    }\r\n\r\n    if (imageFrame.largestPixelValue !== minMax.max) {\r\n      console.warn('Image largestPixelValue tag is incorrect. Rendering performance will suffer considerably.');\r\n    }\r\n  } else {\r\n    imageFrame.smallestPixelValue = minMax.min;\r\n    imageFrame.largestPixelValue = minMax.max;\r\n  }\r\n}\r\n\r\nfunction isNumber (numValue) {\r\n  return typeof numValue === 'number';\r\n}\r\n","function decodeLittleEndian (imageFrame, pixelData) {\r\n  let arrayBuffer = pixelData.buffer;\r\n  let offset = pixelData.byteOffset;\r\n  const length = pixelData.length;\r\n\r\n  if (imageFrame.bitsAllocated === 16) {\r\n    // if pixel data is not aligned on even boundary, shift it so we can create the 16 bit array\r\n    // buffers on it\r\n    if (offset % 2) {\r\n      arrayBuffer = arrayBuffer.slice(offset);\r\n      offset = 0;\r\n    }\r\n\r\n    if (imageFrame.pixelRepresentation === 0) {\r\n      imageFrame.pixelData = new Uint16Array(arrayBuffer, offset, length / 2);\r\n    } else {\r\n      imageFrame.pixelData = new Int16Array(arrayBuffer, offset, length / 2);\r\n    }\r\n  } else if (imageFrame.bitsAllocated === 8 || imageFrame.bitsAllocated === 1) {\r\n    imageFrame.pixelData = pixelData;\r\n  } else if (imageFrame.bitsAllocated === 32) {\r\n    // if pixel data is not aligned on even boundary, shift it\r\n    if (offset % 2) {\r\n      arrayBuffer = arrayBuffer.slice(offset);\r\n      offset = 0;\r\n    }\r\n\r\n    imageFrame.pixelData = new Float32Array(arrayBuffer, offset, length / 4);\r\n  }\r\n\r\n  return imageFrame;\r\n}\r\n\r\nexport default decodeLittleEndian;\r\n","/* eslint no-bitwise: 0 */\r\nfunction swap16 (val) {\r\n  return ((val & 0xFF) << 8) |\r\n    ((val >> 8) & 0xFF);\r\n}\r\n\r\n\r\nfunction decodeBigEndian (imageFrame, pixelData) {\r\n  if (imageFrame.bitsAllocated === 16) {\r\n    let arrayBuffer = pixelData.buffer;\r\n    let offset = pixelData.byteOffset;\r\n    const length = pixelData.length;\r\n    // if pixel data is not aligned on even boundary, shift it so we can create the 16 bit array\r\n    // buffers on it\r\n\r\n    if (offset % 2) {\r\n      arrayBuffer = arrayBuffer.slice(offset);\r\n      offset = 0;\r\n    }\r\n\r\n    if (imageFrame.pixelRepresentation === 0) {\r\n      imageFrame.pixelData = new Uint16Array(arrayBuffer, offset, length / 2);\r\n    } else {\r\n      imageFrame.pixelData = new Int16Array(arrayBuffer, offset, length / 2);\r\n    }\r\n    // Do the byte swap\r\n    for (let i = 0; i < imageFrame.pixelData.length; i++) {\r\n      imageFrame.pixelData[i] = swap16(imageFrame.pixelData[i]);\r\n    }\r\n\r\n  } else if (imageFrame.bitsAllocated === 8) {\r\n    imageFrame.pixelData = pixelData;\r\n  }\r\n\r\n  return imageFrame;\r\n}\r\n\r\nexport default decodeBigEndian;\r\n","function decodeRLE (imageFrame, pixelData) {\r\n  if (imageFrame.bitsAllocated === 8) {\r\n    if (imageFrame.planarConfiguration) {\r\n      return decode8Planar(imageFrame, pixelData);\r\n    }\r\n\r\n    return decode8(imageFrame, pixelData);\r\n  } else if (imageFrame.bitsAllocated === 16) {\r\n    return decode16(imageFrame, pixelData);\r\n  }\r\n\r\n  throw new Error('unsupported pixel format for RLE');\r\n}\r\n\r\nfunction decode8 (imageFrame, pixelData) {\r\n  const frameData = pixelData;\r\n  const frameSize = imageFrame.rows * imageFrame.columns;\r\n  const outFrame = new ArrayBuffer(frameSize * imageFrame.samplesPerPixel);\r\n  const header = new DataView(frameData.buffer, frameData.byteOffset);\r\n  const data = new Int8Array(frameData.buffer, frameData.byteOffset);\r\n  const out = new Int8Array(outFrame);\r\n\r\n  let outIndex = 0;\r\n  const numSegments = header.getInt32(0, true);\r\n\r\n  for (let s = 0; s < numSegments; ++s) {\r\n    outIndex = s;\r\n\r\n    let inIndex = header.getInt32((s + 1) * 4, true);\r\n    let maxIndex = header.getInt32((s + 2) * 4, true);\r\n\r\n    if (maxIndex === 0) {\r\n      maxIndex = frameData.length;\r\n    }\r\n\r\n    const endOfSegment = frameSize * numSegments;\r\n\r\n    while (inIndex < maxIndex) {\r\n      const n = data[inIndex++];\r\n\r\n      if (n >= 0 && n <= 127) {\r\n        // copy n bytes\r\n        for (let i = 0; i < n + 1 && outIndex < endOfSegment; ++i) {\r\n          out[outIndex] = data[inIndex++];\r\n          outIndex += imageFrame.samplesPerPixel;\r\n        }\r\n      } else if (n <= -1 && n >= -127) {\r\n        const value = data[inIndex++];\r\n        // run of n bytes\r\n\r\n        for (let j = 0; j < -n + 1 && outIndex < endOfSegment; ++j) {\r\n          out[outIndex] = value;\r\n          outIndex += imageFrame.samplesPerPixel;\r\n        }\r\n      }/* else if (n === -128) {\r\n\r\n      } // do nothing */\r\n    }\r\n  }\r\n  imageFrame.pixelData = new Uint8Array(outFrame);\r\n\r\n  return imageFrame;\r\n}\r\n\r\nfunction decode8Planar (imageFrame, pixelData) {\r\n  const frameData = pixelData;\r\n  const frameSize = imageFrame.rows * imageFrame.columns;\r\n  const outFrame = new ArrayBuffer(frameSize * imageFrame.samplesPerPixel);\r\n  const header = new DataView(frameData.buffer, frameData.byteOffset);\r\n  const data = new Int8Array(frameData.buffer, frameData.byteOffset);\r\n  const out = new Int8Array(outFrame);\r\n\r\n  let outIndex = 0;\r\n  const numSegments = header.getInt32(0, true);\r\n\r\n  for (let s = 0; s < numSegments; ++s) {\r\n    outIndex = s * frameSize;\r\n\r\n    let inIndex = header.getInt32((s + 1) * 4, true);\r\n    let maxIndex = header.getInt32((s + 2) * 4, true);\r\n\r\n    if (maxIndex === 0) {\r\n      maxIndex = frameData.length;\r\n    }\r\n\r\n    const endOfSegment = frameSize * numSegments;\r\n\r\n    while (inIndex < maxIndex) {\r\n      const n = data[inIndex++];\r\n\r\n      if (n >= 0 && n <= 127) {\r\n        // copy n bytes\r\n        for (let i = 0; i < n + 1 && outIndex < endOfSegment; ++i) {\r\n          out[outIndex] = data[inIndex++];\r\n          outIndex++;\r\n        }\r\n      } else if (n <= -1 && n >= -127) {\r\n        const value = data[inIndex++];\r\n        // run of n bytes\r\n\r\n        for (let j = 0; j < -n + 1 && outIndex < endOfSegment; ++j) {\r\n          out[outIndex] = value;\r\n          outIndex++;\r\n        }\r\n      }/* else if (n === -128) {\r\n\r\n      } // do nothing */\r\n    }\r\n  }\r\n  imageFrame.pixelData = new Uint8Array(outFrame);\r\n\r\n  return imageFrame;\r\n}\r\n\r\nfunction decode16 (imageFrame, pixelData) {\r\n  const frameData = pixelData;\r\n  const frameSize = imageFrame.rows * imageFrame.columns;\r\n  const outFrame = new ArrayBuffer(frameSize * imageFrame.samplesPerPixel * 2);\r\n\r\n  const header = new DataView(frameData.buffer, frameData.byteOffset);\r\n  const data = new Int8Array(frameData.buffer, frameData.byteOffset);\r\n  const out = new Int8Array(outFrame);\r\n\r\n  const numSegments = header.getInt32(0, true);\r\n\r\n  for (let s = 0; s < numSegments; ++s) {\r\n    let outIndex = 0;\r\n    const highByte = (s === 0 ? 1 : 0);\r\n\r\n    let inIndex = header.getInt32((s + 1) * 4, true);\r\n    let maxIndex = header.getInt32((s + 2) * 4, true);\r\n\r\n    if (maxIndex === 0) {\r\n      maxIndex = frameData.length;\r\n    }\r\n\r\n    while (inIndex < maxIndex) {\r\n      const n = data[inIndex++];\r\n\r\n      if (n >= 0 && n <= 127) {\r\n        for (let i = 0; i < n + 1 && outIndex < frameSize; ++i) {\r\n          out[(outIndex * 2) + highByte] = data[inIndex++];\r\n          outIndex++;\r\n        }\r\n      } else if (n <= -1 && n >= -127) {\r\n        const value = data[inIndex++];\r\n\r\n        for (let j = 0; j < -n + 1 && outIndex < frameSize; ++j) {\r\n          out[(outIndex * 2) + highByte] = value;\r\n          outIndex++;\r\n        }\r\n      }/* else if (n === -128) {\r\n\r\n      } // do nothing */\r\n    }\r\n  }\r\n  if (imageFrame.pixelRepresentation === 0) {\r\n    imageFrame.pixelData = new Uint16Array(outFrame);\r\n  } else {\r\n    imageFrame.pixelData = new Int16Array(outFrame);\r\n  }\r\n\r\n  return imageFrame;\r\n}\r\n\r\nexport default decodeRLE;\r\n","\r\n\r\nfunction decodeJPEGBaseline (imageFrame, pixelData) {\r\n  // check to make sure codec is loaded\r\n  if (typeof JpegImage === 'undefined') {\r\n    throw new Error('No JPEG Baseline decoder loaded');\r\n  }\r\n  const jpeg = new JpegImage();\r\n\r\n  jpeg.parse(pixelData);\r\n\r\n  // Do not use the internal jpeg.js color transformation,\r\n  // since we will handle this afterwards\r\n  jpeg.colorTransform = false;\r\n\r\n  if (imageFrame.bitsAllocated === 8) {\r\n    imageFrame.pixelData = jpeg.getData(imageFrame.columns, imageFrame.rows);\r\n\r\n    return imageFrame;\r\n  } else if (imageFrame.bitsAllocated === 16) {\r\n    imageFrame.pixelData = jpeg.getData16(imageFrame.columns, imageFrame.rows);\r\n\r\n    return imageFrame;\r\n  }\r\n}\r\n\r\nexport default decodeJPEGBaseline;\r\n","\r\n\r\nfunction decodeJPEGLossless (imageFrame, pixelData) {\r\n  // check to make sure codec is loaded\r\n  if (typeof jpeg === 'undefined' ||\r\n    typeof jpeg.lossless === 'undefined' ||\r\n    typeof jpeg.lossless.Decoder === 'undefined') {\r\n    throw new Error('No JPEG Lossless decoder loaded');\r\n  }\r\n\r\n  const byteOutput = imageFrame.bitsAllocated <= 8 ? 1 : 2;\r\n  // console.time('jpeglossless');\r\n  const buffer = pixelData.buffer;\r\n  const decoder = new jpeg.lossless.Decoder();\r\n  const decompressedData = decoder.decode(buffer, pixelData.byteOffset, pixelData.length, byteOutput);\r\n  // console.timeEnd('jpeglossless');\r\n\r\n  if (imageFrame.pixelRepresentation === 0) {\r\n    if (imageFrame.bitsAllocated === 16) {\r\n      imageFrame.pixelData = new Uint16Array(decompressedData.buffer);\r\n\r\n      return imageFrame;\r\n    }\r\n    // untested!\r\n    imageFrame.pixelData = new Uint8Array(decompressedData.buffer);\r\n\r\n    return imageFrame;\r\n\r\n  }\r\n  imageFrame.pixelData = new Int16Array(decompressedData.buffer);\r\n\r\n  return imageFrame;\r\n\r\n}\r\n\r\nexport default decodeJPEGLossless;\r\n","import decodeLittleEndian from './decoders/decodeLittleEndian.js';\r\nimport decodeBigEndian from './decoders/decodeBigEndian.js';\r\nimport decodeRLE from './decoders/decodeRLE.js';\r\nimport decodeJPEGBaseline from './decoders/decodeJPEGBaseline.js';\r\nimport decodeJPEGLossless from './decoders/decodeJPEGLossless.js';\r\nimport decodeJPEGLS from './decoders/decodeJPEGLS.js';\r\nimport decodeJPEG2000 from './decoders/decodeJPEG2000.js';\r\n\r\nfunction decodeImageFrame (imageFrame, transferSyntax, pixelData, decodeConfig, options) {\r\n  const start = new Date().getTime();\r\n\r\n  if (transferSyntax === '1.2.840.10008.1.2') {\r\n    // Implicit VR Little Endian\r\n    imageFrame = decodeLittleEndian(imageFrame, pixelData);\r\n  } else if (transferSyntax === '1.2.840.10008.1.2.1') {\r\n    // Explicit VR Little Endian\r\n    imageFrame = decodeLittleEndian(imageFrame, pixelData);\r\n  } else if (transferSyntax === '1.2.840.10008.1.2.2') {\r\n    // Explicit VR Big Endian (retired)\r\n    imageFrame = decodeBigEndian(imageFrame, pixelData);\r\n  } else if (transferSyntax === '1.2.840.10008.1.2.1.99') {\r\n    // Deflate transfer syntax (deflated by dicomParser)\r\n    imageFrame = decodeLittleEndian(imageFrame, pixelData);\r\n  } else if (transferSyntax === '1.2.840.10008.1.2.5') {\r\n    // RLE Lossless\r\n    imageFrame = decodeRLE(imageFrame, pixelData);\r\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.50') {\r\n    // JPEG Baseline lossy process 1 (8 bit)\r\n    imageFrame = decodeJPEGBaseline(imageFrame, pixelData);\r\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.51') {\r\n    // JPEG Baseline lossy process 2 & 4 (12 bit)\r\n    imageFrame = decodeJPEGBaseline(imageFrame, pixelData);\r\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.57') {\r\n    // JPEG Lossless, Nonhierarchical (Processes 14)\r\n    imageFrame = decodeJPEGLossless(imageFrame, pixelData);\r\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.70') {\r\n    // JPEG Lossless, Nonhierarchical (Processes 14 [Selection 1])\r\n    imageFrame = decodeJPEGLossless(imageFrame, pixelData);\r\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.80') {\r\n    // JPEG-LS Lossless Image Compression\r\n    imageFrame = decodeJPEGLS(imageFrame, pixelData);\r\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.81') {\r\n    // JPEG-LS Lossy (Near-Lossless) Image Compression\r\n    imageFrame = decodeJPEGLS(imageFrame, pixelData);\r\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.90') {\r\n    // JPEG 2000 Lossless\r\n    imageFrame = decodeJPEG2000(imageFrame, pixelData, decodeConfig, options);\r\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.91') {\r\n    // JPEG 2000 Lossy\r\n    imageFrame = decodeJPEG2000(imageFrame, pixelData, decodeConfig, options);\r\n  } else {\r\n    throw new Error(`no decoder for transfer syntax ${transferSyntax}`);\r\n  }\r\n\r\n  /* Don't know if these work...\r\n   // JPEG 2000 Part 2 Multicomponent Image Compression (Lossless Only)\r\n   else if(transferSyntax === \"1.2.840.10008.1.2.4.92\")\r\n   {\r\n   return decodeJPEG2000(dataSet, frame);\r\n   }\r\n   // JPEG 2000 Part 2 Multicomponent Image Compression\r\n   else if(transferSyntax === \"1.2.840.10008.1.2.4.93\")\r\n   {\r\n   return decodeJPEG2000(dataSet, frame);\r\n   }\r\n   */\r\n\r\n  const shouldShift = imageFrame.pixelRepresentation !== undefined && imageFrame.pixelRepresentation === 1;\r\n  const shift = (shouldShift && imageFrame.bitsStored !== undefined) ? (32 - imageFrame.bitsStored) : undefined;\r\n\r\n  if (shouldShift && shift !== undefined) {\r\n    for (let i = 0; i < imageFrame.pixelData.length; i++) {\r\n      // eslint-disable-next-line no-bitwise\r\n      imageFrame.pixelData[i] = (imageFrame.pixelData[i] << shift >> shift);\r\n    }\r\n  }\r\n\r\n  const end = new Date().getTime();\r\n\r\n  imageFrame.decodeTimeInMS = end - start;\r\n\r\n  return imageFrame;\r\n}\r\n\r\nexport default decodeImageFrame;\r\n","export default function (imageFrame, rgbaBuffer) {\r\n  if (imageFrame === undefined) {\r\n    throw new Error('decodeRGB: rgbBuffer must not be undefined');\r\n  }\r\n  if (imageFrame.length % 3 !== 0) {\r\n    throw new Error('decodeRGB: rgbBuffer length must be divisible by 3');\r\n  }\r\n\r\n  const numPixels = imageFrame.length / 3;\r\n  let rgbIndex = 0;\r\n  let rgbaIndex = 0;\r\n\r\n  for (let i = 0; i < numPixels; i++) {\r\n    rgbaBuffer[rgbaIndex++] = imageFrame[rgbIndex++]; // red\r\n    rgbaBuffer[rgbaIndex++] = imageFrame[rgbIndex++]; // green\r\n    rgbaBuffer[rgbaIndex++] = imageFrame[rgbIndex++]; // blue\r\n    rgbaBuffer[rgbaIndex++] = 255; // alpha\r\n  }\r\n}\r\n","export default function (imageFrame, rgbaBuffer) {\r\n  if (imageFrame === undefined) {\r\n    throw new Error('decodeRGB: rgbBuffer must not be undefined');\r\n  }\r\n  if (imageFrame.length % 3 !== 0) {\r\n    throw new Error('decodeRGB: rgbBuffer length must be divisible by 3');\r\n  }\r\n\r\n  const numPixels = imageFrame.length / 3;\r\n  let rgbaIndex = 0;\r\n  let rIndex = 0;\r\n  let gIndex = numPixels;\r\n  let bIndex = numPixels * 2;\r\n\r\n  for (let i = 0; i < numPixels; i++) {\r\n    rgbaBuffer[rgbaIndex++] = imageFrame[rIndex++]; // red\r\n    rgbaBuffer[rgbaIndex++] = imageFrame[gIndex++]; // green\r\n    rgbaBuffer[rgbaIndex++] = imageFrame[bIndex++]; // blue\r\n    rgbaBuffer[rgbaIndex++] = 255; // alpha\r\n  }\r\n}\r\n","export default function (imageFrame, rgbaBuffer) {\r\n  if (imageFrame === undefined) {\r\n    throw new Error('decodeRGB: ybrBuffer must not be undefined');\r\n  }\r\n  if (imageFrame.length % 3 !== 0) {\r\n    throw new Error('decodeRGB: ybrBuffer length must be divisble by 3');\r\n  }\r\n\r\n  const numPixels = imageFrame.length / 3;\r\n  let ybrIndex = 0;\r\n  let rgbaIndex = 0;\r\n\r\n  for (let i = 0; i < numPixels; i++) {\r\n    const y = imageFrame[ybrIndex++];\r\n    const cb = imageFrame[ybrIndex++];\r\n    const cr = imageFrame[ybrIndex++];\r\n\r\n    rgbaBuffer[rgbaIndex++] = y + 1.40200 * (cr - 128);// red\r\n    rgbaBuffer[rgbaIndex++] = y - 0.34414 * (cb - 128) - 0.71414 * (cr - 128); // green\r\n    rgbaBuffer[rgbaIndex++] = y + 1.77200 * (cb - 128); // blue\r\n    rgbaBuffer[rgbaIndex++] = 255; // alpha\r\n  }\r\n}\r\n","export default function (imageFrame, rgbaBuffer) {\r\n  if (imageFrame === undefined) {\r\n    throw new Error('decodeRGB: ybrBuffer must not be undefined');\r\n  }\r\n  if (imageFrame.length % 3 !== 0) {\r\n    throw new Error('decodeRGB: ybrBuffer length must be divisble by 3');\r\n  }\r\n\r\n  const numPixels = imageFrame.length / 3;\r\n  let rgbaIndex = 0;\r\n  let yIndex = 0;\r\n  let cbIndex = numPixels;\r\n  let crIndex = numPixels * 2;\r\n\r\n  for (let i = 0; i < numPixels; i++) {\r\n    const y = imageFrame[yIndex++];\r\n    const cb = imageFrame[cbIndex++];\r\n    const cr = imageFrame[crIndex++];\r\n\r\n    rgbaBuffer[rgbaIndex++] = y + 1.40200 * (cr - 128);// red\r\n    rgbaBuffer[rgbaIndex++] = y - 0.34414 * (cb - 128) - 0.71414 * (cr - 128); // green\r\n    rgbaBuffer[rgbaIndex++] = y + 1.77200 * (cb - 128); // blue\r\n    rgbaBuffer[rgbaIndex++] = 255; // alpha\r\n  }\r\n}\r\n","/* eslint no-bitwise: 0 */\r\n\r\nfunction convertLUTto8Bit (lut, shift) {\r\n  const numEntries = lut.length;\r\n  const cleanedLUT = new Uint8ClampedArray(numEntries);\r\n\r\n  for (let i = 0; i < numEntries; ++i) {\r\n    cleanedLUT[i] = lut[i] >> shift;\r\n  }\r\n\r\n  return cleanedLUT;\r\n}\r\n\r\n/**\r\n * Convert pixel data with PALETTE COLOR Photometric Interpretation to RGBA\r\n *\r\n * @param {ImageFrame} imageFrame\r\n * @param {Uint8ClampedArray} rgbaBuffer\r\n * @returns {void}\r\n */\r\nexport default function (imageFrame, rgbaBuffer) {\r\n  const numPixels = imageFrame.columns * imageFrame.rows;\r\n  const pixelData = imageFrame.pixelData;\r\n  const rData = imageFrame.redPaletteColorLookupTableData;\r\n  const gData = imageFrame.greenPaletteColorLookupTableData;\r\n  const bData = imageFrame.bluePaletteColorLookupTableData;\r\n  const len = imageFrame.redPaletteColorLookupTableData.length;\r\n  let palIndex = 0;\r\n  let rgbaIndex = 0;\r\n\r\n  const start = imageFrame.redPaletteColorLookupTableDescriptor[1];\r\n  const shift = imageFrame.redPaletteColorLookupTableDescriptor[2] === 8 ? 0 : 8;\r\n\r\n  const rDataCleaned = convertLUTto8Bit(rData, shift);\r\n  const gDataCleaned = convertLUTto8Bit(gData, shift);\r\n  const bDataCleaned = convertLUTto8Bit(bData, shift);\r\n\r\n  for (let i = 0; i < numPixels; ++i) {\r\n    let value = pixelData[palIndex++];\r\n\r\n    if (value < start) {\r\n      value = 0;\r\n    } else if (value > start + len - 1) {\r\n      value = len - 1;\r\n    } else {\r\n      value -= start;\r\n    }\r\n\r\n    rgbaBuffer[rgbaIndex++] = rDataCleaned[value];\r\n    rgbaBuffer[rgbaIndex++] = gDataCleaned[value];\r\n    rgbaBuffer[rgbaIndex++] = bDataCleaned[value];\r\n    rgbaBuffer[rgbaIndex++] = 255;\r\n  }\r\n}\r\n","function getLutDescriptor (dataSet, tag) {\r\n  if (!dataSet.elements[tag] || dataSet.elements[tag].length !== 6) {\r\n    return;\r\n  }\r\n\r\n  return [dataSet.uint16(tag, 0), dataSet.uint16(tag, 1), dataSet.uint16(tag, 2)];\r\n}\r\n\r\nfunction getLutData (lutDataSet, tag, lutDescriptor) {\r\n  const lut = [];\r\n  const lutData = lutDataSet.elements[tag];\r\n\r\n  for (let i = 0; i < lutDescriptor[0]; i++) {\r\n    // Output range is always unsigned\r\n    if (lutDescriptor[2] === 16) {\r\n      lut[i] = lutDataSet.uint16(tag, i);\r\n    } else {\r\n      lut[i] = lutDataSet.byteArray[i + lutData.dataOffset];\r\n    }\r\n  }\r\n\r\n  return lut;\r\n}\r\n\r\nfunction populatePaletteColorLut (dataSet, imagePixelModule) {\r\n  imagePixelModule.redPaletteColorLookupTableDescriptor = getLutDescriptor(dataSet, 'x00281101');\r\n  imagePixelModule.greenPaletteColorLookupTableDescriptor = getLutDescriptor(dataSet, 'x00281102');\r\n  imagePixelModule.bluePaletteColorLookupTableDescriptor = getLutDescriptor(dataSet, 'x00281103');\r\n\r\n  // The first Palette Color Lookup Table Descriptor value is the number of entries in the lookup table.\r\n  // When the number of table entries is equal to 2ˆ16 then this value shall be 0.\r\n  // See http://dicom.nema.org/MEDICAL/DICOM/current/output/chtml/part03/sect_C.7.6.3.html#sect_C.7.6.3.1.5\r\n  if (imagePixelModule.redPaletteColorLookupTableDescriptor[0] === 0) {\r\n    imagePixelModule.redPaletteColorLookupTableDescriptor[0] = 65536;\r\n    imagePixelModule.greenPaletteColorLookupTableDescriptor[0] = 65536;\r\n    imagePixelModule.bluePaletteColorLookupTableDescriptor[0] = 65536;\r\n  }\r\n\r\n  // The third Palette Color Lookup Table Descriptor value specifies the number of bits for each entry in the Lookup Table Data.\r\n  // It shall take the value of 8 or 16.\r\n  // The LUT Data shall be stored in a format equivalent to 8 bits allocated when the number of bits for each entry is 8, and 16 bits allocated when the number of bits for each entry is 16, where in both cases the high bit is equal to bits allocated-1.\r\n  // The third value shall be identical for each of the Red, Green and Blue Palette Color Lookup Table Descriptors.\r\n  //\r\n  // Note: Some implementations have encoded 8 bit entries with 16 bits allocated, padding the high bits;\r\n  // this can be detected by comparing the number of entries specified in the LUT Descriptor with the actual value length of the LUT Data entry.\r\n  // The value length in bytes should equal the number of entries if bits allocated is 8, and be twice as long if bits allocated is 16.\r\n  const numLutEntries = imagePixelModule.redPaletteColorLookupTableDescriptor[0];\r\n  const lutData = dataSet.elements.x00281201;\r\n  const lutBitsAllocated = lutData.length === numLutEntries ? 8 : 16;\r\n\r\n  // If the descriptors do not appear to have the correct values, correct them\r\n  if (imagePixelModule.redPaletteColorLookupTableDescriptor[2] !== lutBitsAllocated) {\r\n    imagePixelModule.redPaletteColorLookupTableDescriptor[2] = lutBitsAllocated;\r\n    imagePixelModule.greenPaletteColorLookupTableDescriptor[2] = lutBitsAllocated;\r\n    imagePixelModule.bluePaletteColorLookupTableDescriptor[2] = lutBitsAllocated;\r\n  }\r\n\r\n  imagePixelModule.redPaletteColorLookupTableData = getLutData(dataSet, 'x00281201', imagePixelModule.redPaletteColorLookupTableDescriptor);\r\n  imagePixelModule.greenPaletteColorLookupTableData = getLutData(dataSet, 'x00281202', imagePixelModule.greenPaletteColorLookupTableDescriptor);\r\n  imagePixelModule.bluePaletteColorLookupTableData = getLutData(dataSet, 'x00281203', imagePixelModule.bluePaletteColorLookupTableDescriptor);\r\n}\r\n\r\nfunction populateSmallestLargestPixelValues (dataSet, imagePixelModule) {\r\n  const pixelRepresentation = dataSet.uint16('x00280103');\r\n\r\n  if (pixelRepresentation === 0) {\r\n    imagePixelModule.smallestPixelValue = dataSet.uint16('x00280106');\r\n    imagePixelModule.largestPixelValue = dataSet.uint16('x00280107');\r\n  } else {\r\n    imagePixelModule.smallestPixelValue = dataSet.int16('x00280106');\r\n    imagePixelModule.largestPixelValue = dataSet.int16('x00280107');\r\n  }\r\n}\r\n\r\nfunction getImagePixelModule (dataSet) {\r\n  const imagePixelModule = {\r\n    samplesPerPixel: dataSet.uint16('x00280002'),\r\n    photometricInterpretation: dataSet.string('x00280004'),\r\n    rows: dataSet.uint16('x00280010'),\r\n    columns: dataSet.uint16('x00280011'),\r\n    bitsAllocated: dataSet.uint16('x00280100'),\r\n    bitsStored: dataSet.uint16('x00280101'),\r\n    highBit: dataSet.uint16('x00280102'),\r\n    pixelRepresentation: dataSet.uint16('x00280103'),\r\n    planarConfiguration: dataSet.uint16('x00280006'),\r\n    pixelAspectRatio: dataSet.string('x00280034')\r\n  };\r\n\r\n  populateSmallestLargestPixelValues(dataSet, imagePixelModule);\r\n\r\n  if (imagePixelModule.photometricInterpretation === 'PALETTE COLOR' && dataSet.elements.x00281101) {\r\n    populatePaletteColorLut(dataSet, imagePixelModule);\r\n  }\r\n\r\n  return imagePixelModule;\r\n}\r\n\r\nexport default getImagePixelModule;\r\n","function getLUT (pixelRepresentation, lutDataSet) {\r\n  let numLUTEntries = lutDataSet.uint16('x00283002', 0);\r\n\r\n  if (numLUTEntries === 0) {\r\n    numLUTEntries = 65535;\r\n  }\r\n  let firstValueMapped = 0;\r\n\r\n  if (pixelRepresentation === 0) {\r\n    firstValueMapped = lutDataSet.uint16('x00283002', 1);\r\n  } else {\r\n    firstValueMapped = lutDataSet.int16('x00283002', 1);\r\n  }\r\n  const numBitsPerEntry = lutDataSet.uint16('x00283002', 2);\r\n  // console.log('LUT(', numLUTEntries, ',', firstValueMapped, ',', numBitsPerEntry, ')');\r\n  const lut = {\r\n    id: '1',\r\n    firstValueMapped,\r\n    numBitsPerEntry,\r\n    lut: []\r\n  };\r\n\r\n  // console.log(\"minValue=\", minValue, \"; maxValue=\", maxValue);\r\n  for (let i = 0; i < numLUTEntries; i++) {\r\n    if (pixelRepresentation === 0) {\r\n      lut.lut[i] = lutDataSet.uint16('x00283006', i);\r\n    } else {\r\n      lut.lut[i] = lutDataSet.int16('x00283006', i);\r\n    }\r\n  }\r\n\r\n  return lut;\r\n}\r\n\r\n\r\nfunction getLUTs (pixelRepresentation, lutSequence) {\r\n  if (!lutSequence || !lutSequence.items.length) {\r\n    return;\r\n  }\r\n  const luts = [];\r\n\r\n  for (let i = 0; i < lutSequence.items.length; i++) {\r\n    const lutDataSet = lutSequence.items[i].dataSet;\r\n    const lut = getLUT(pixelRepresentation, lutDataSet);\r\n\r\n    if (lut) {\r\n      luts.push(lut);\r\n    }\r\n  }\r\n\r\n  return luts;\r\n}\r\n\r\nexport default getLUTs;\r\n","/* eslint no-bitwise: 0 */\r\n\r\nfunction getMinStoredPixelValue (dataSet) {\r\n  const pixelRepresentation = dataSet.uint16('x00280103');\r\n  const bitsStored = dataSet.uint16('x00280101');\r\n\r\n  if (pixelRepresentation === 0) {\r\n    return 0;\r\n  }\r\n\r\n  return -1 << (bitsStored - 1);\r\n}\r\n\r\n// 0 = unsigned / US, 1 = signed / SS\r\nfunction getModalityLUTOutputPixelRepresentation (dataSet) {\r\n\r\n  // CT SOP Classes are always signed\r\n  const sopClassUID = dataSet.string('x00080016');\r\n\r\n  if (sopClassUID === '1.2.840.10008.5.1.4.1.1.2' ||\r\n    sopClassUID === '1.2.840.10008.5.1.4.1.1.2.1') {\r\n    return 1;\r\n  }\r\n\r\n  // if rescale intercept and rescale slope are present, pass the minimum stored\r\n  // pixel value through them to see if we get a signed output range\r\n  const rescaleIntercept = dataSet.floatString('x00281052');\r\n  const rescaleSlope = dataSet.floatString('x00281053');\r\n\r\n  if (rescaleIntercept !== undefined && rescaleSlope !== undefined) {\r\n    const minStoredPixelValue = getMinStoredPixelValue(dataSet); //\r\n    const minModalityLutValue = minStoredPixelValue * rescaleSlope + rescaleIntercept;\r\n\r\n    if (minModalityLutValue < 0) {\r\n      return 1;\r\n    }\r\n\r\n    return 0;\r\n\r\n  }\r\n\r\n  // Output of non linear modality lut is always unsigned\r\n  if (dataSet.elements.x00283000 && dataSet.elements.x00283000.length > 0) {\r\n    return 0;\r\n  }\r\n\r\n  // If no modality lut transform, output is same as pixel representation\r\n  return dataSet.uint16('x00280103');\r\n}\r\n\r\nexport default getModalityLUTOutputPixelRepresentation;\r\n","function getNumberValues (dataSet, tag, minimumLength) {\r\n  const values = [];\r\n  const valueAsString = dataSet.string(tag);\r\n\r\n  if (!valueAsString) {\r\n    return;\r\n  }\r\n  const split = valueAsString.split('\\\\');\r\n\r\n  if (minimumLength && split.length < minimumLength) {\r\n    return;\r\n  }\r\n  for (let i = 0; i < split.length; i++) {\r\n    values.push(parseFloat(split[i]));\r\n  }\r\n\r\n  return values;\r\n}\r\n\r\nexport default getNumberValues;\r\n","\r\n\r\n/**\r\n * Returns the raw value\r\n *\r\n * @param element - The javascript object for the specified element in the metadata\r\n * @param [index] - the index of the value in a multi-valued element, default is 0\r\n * @param [defaultValue] - The default value to return if the element does not exist\r\n * @returns {*}\r\n */\r\nfunction getValue (element, index, defaultValue) {\r\n  index = index || 0;\r\n  if (!element) {\r\n    return defaultValue;\r\n  }\r\n  // Value is not present if the attribute has a zero length value\r\n  if (!element.Value) {\r\n    return defaultValue;\r\n  }\r\n  // make sure we have the specified index\r\n  if (element.Value.length <= index) {\r\n    return defaultValue;\r\n  }\r\n\r\n  return element.Value[index];\r\n}\r\n\r\nexport default getValue;\r\n","import getValue from './getValue.js';\r\n\r\n/**\r\n * Returns the first string value as a Javascript number\r\n *\r\n * @param element - The javascript object for the specified element in the metadata\r\n * @param [index] - the index of the value in a multi-valued element, default is 0\r\n * @param [defaultValue] - The default value to return if the element does not exist\r\n * @returns {*}\r\n */\r\nfunction getNumberString (element, index, defaultValue) {\r\n  const value = getValue(element, index, defaultValue);\r\n\r\n  if (value === undefined) {\r\n    return;\r\n  }\r\n\r\n  return parseFloat(value);\r\n}\r\n\r\nexport default getNumberString;\r\n","import getValue from './getValue.js';\r\n\r\nfunction getNumberValue (element, index) {\r\n  const value = getValue(element, index);\r\n\r\n  if (value === undefined) {\r\n    return;\r\n  }\r\n\r\n  return parseFloat(value);\r\n}\r\n\r\nexport default getNumberValue;\r\n","\r\n\r\n/**\r\n * Returns the values as an array of javascript numbers\r\n *\r\n * @param element - The javascript object for the specified element in the metadata\r\n * @param [minimumLength] - the minimum number of values\r\n * @returns {*}\r\n */\r\nfunction getNumberValues (element, minimumLength) {\r\n  if (!element) {\r\n    return;\r\n  }\r\n  // Value is not present if the attribute has a zero length value\r\n  if (!element.Value) {\r\n    return;\r\n  }\r\n  // make sure we have the expected length\r\n  if (minimumLength && element.Value.length < minimumLength) {\r\n    return;\r\n  }\r\n\r\n  const values = [];\r\n\r\n  for (let i = 0; i < element.Value.length; i++) {\r\n    values.push(parseFloat(element.Value[i]));\r\n  }\r\n\r\n  return values;\r\n}\r\n\r\nexport default getNumberValues;\r\n","\r\n\r\nlet imageIds = [];\r\n\r\nfunction add (imageId, metadata) {\r\n  imageIds[imageId] = metadata;\r\n}\r\n\r\nfunction get (imageId) {\r\n  return imageIds[imageId];\r\n}\r\n\r\nfunction remove (imageId) {\r\n  imageIds[imageId] = undefined;\r\n}\r\n\r\nfunction purge () {\r\n  imageIds = [];\r\n}\r\n\r\nexport default {\r\n  add,\r\n  get,\r\n  remove,\r\n  purge\r\n};\r\n","import external from '../../../externalModules.js';\r\nimport getNumberValues from './getNumberValues.js';\r\nimport getValue from './getValue.js';\r\nimport getNumberValue from './getNumberValue.js';\r\nimport metaDataManager from '../metaDataManager.js';\r\n\r\nfunction metaDataProvider (type, imageId) {\r\n  const { dicomParser } = external;\r\n  const metaData = metaDataManager.get(imageId);\r\n\r\n  if (!metaData) {\r\n    return;\r\n  }\r\n\r\n  if (type === 'generalSeriesModule') {\r\n    return {\r\n      modality: getValue(metaData['00080060']),\r\n      seriesInstanceUID: getValue(metaData['0020000e']),\r\n      seriesNumber: getNumberValue(metaData['00200011']),\r\n      studyInstanceUID: getValue(metaData['0020000d']),\r\n      seriesDate: dicomParser.parseDA(getValue(metaData['00080021'])),\r\n      seriesTime: dicomParser.parseTM(getValue(metaData['00080031'], 0, ''))\r\n    };\r\n  }\r\n\r\n  if (type === 'patientStudyModule') {\r\n    return {\r\n      patientAge: getNumberValue(metaData['00101010']),\r\n      patientSize: getNumberValue(metaData['00101020']),\r\n      patientWeight: getNumberValue(metaData['00101030'])\r\n    };\r\n  }\r\n\r\n  if (type === 'imagePlaneModule') {\r\n    const imageOrientationPatient = getNumberValues(metaData['00200037'], 6);\r\n    const imagePositionPatient = getNumberValues(metaData['00200032'], 3);\r\n    const pixelSpacing = getNumberValues(metaData['00280030'], 2);\r\n    let columnPixelSpacing = null;\r\n    let rowPixelSpacing = null;\r\n\r\n    if (pixelSpacing) {\r\n      rowPixelSpacing = pixelSpacing[0];\r\n      columnPixelSpacing = pixelSpacing[1];\r\n    }\r\n\r\n    let rowCosines = null;\r\n    let columnCosines = null;\r\n\r\n    if (imageOrientationPatient) {\r\n      rowCosines = [parseFloat(imageOrientationPatient[0]), parseFloat(imageOrientationPatient[1]), parseFloat(imageOrientationPatient[2])];\r\n      columnCosines = [parseFloat(imageOrientationPatient[3]), parseFloat(imageOrientationPatient[4]), parseFloat(imageOrientationPatient[5])];\r\n    }\r\n\r\n    return {\r\n      frameOfReferenceUID: getValue(metaData['00200052']),\r\n      rows: getNumberValue(metaData['00280010']),\r\n      columns: getNumberValue(metaData['00280011']),\r\n      imageOrientationPatient,\r\n      rowCosines,\r\n      columnCosines,\r\n      imagePositionPatient,\r\n      sliceThickness: getNumberValue(metaData['00180050']),\r\n      sliceLocation: getNumberValue(metaData['00201041']),\r\n      pixelSpacing,\r\n      rowPixelSpacing,\r\n      columnPixelSpacing\r\n    };\r\n  }\r\n\r\n  if (type === 'imagePixelModule') {\r\n    return {\r\n      samplesPerPixel: getNumberValue(metaData['00280002']),\r\n      photometricInterpretation: getValue(metaData['00280004']),\r\n      rows: getNumberValue(metaData['00280010']),\r\n      columns: getNumberValue(metaData['00280011']),\r\n      bitsAllocated: getNumberValue(metaData['00280100']),\r\n      bitsStored: getNumberValue(metaData['00280101']),\r\n      highBit: getValue(metaData['00280102']),\r\n      pixelRepresentation: getNumberValue(metaData['00280103']),\r\n      planarConfiguration: getNumberValue(metaData['00280006']),\r\n      pixelAspectRatio: getValue(metaData['00280034']),\r\n      smallestPixelValue: getNumberValue(metaData['00280106']),\r\n      largestPixelValue: getNumberValue(metaData['00280107']),\r\n      redPaletteColorLookupTableDescriptor: getNumberValues(metaData['00281101']),\r\n      greenPaletteColorLookupTableDescriptor: getNumberValues(metaData['00281102']),\r\n      bluePaletteColorLookupTableDescriptor: getNumberValues(metaData['00281103']),\r\n      redPaletteColorLookupTableData: getNumberValues(metaData['00281201']),\r\n      greenPaletteColorLookupTableData: getNumberValues(metaData['00281202']),\r\n      bluePaletteColorLookupTableData: getNumberValues(metaData['00281203'])\r\n    };\r\n  }\r\n\r\n  if (type === 'voiLutModule') {\r\n    return {\r\n      // TODO VOT LUT Sequence\r\n      windowCenter: getNumberValues(metaData['00281050'], 1),\r\n      windowWidth: getNumberValues(metaData['00281051'], 1)\r\n    };\r\n  }\r\n\r\n  if (type === 'modalityLutModule') {\r\n    return {\r\n      // TODO VOT LUT Sequence\r\n      rescaleIntercept: getNumberValue(metaData['00281052']),\r\n      rescaleSlope: getNumberValue(metaData['00281053']),\r\n      rescaleType: getValue(metaData['00281054'])\r\n    };\r\n  }\r\n\r\n  if (type === 'sopCommonModule') {\r\n    return {\r\n      sopClassUID: getValue(metaData['00080016']),\r\n      sopInstanceUID: getValue(metaData['00080018'])\r\n    };\r\n  }\r\n\r\n  if (type === 'petIsotopeModule') {\r\n    const radiopharmaceuticalInfo = getValue(metaData['00540016']);\r\n\r\n    if (radiopharmaceuticalInfo === undefined) {\r\n      return;\r\n    }\r\n\r\n    return {\r\n      radiopharmaceuticalInfo: {\r\n        radiopharmaceuticalStartTime: dicomParser.parseTM(getValue(radiopharmaceuticalInfo['00181072'], 0, '')),\r\n        radionuclideTotalDose: getNumberValue(radiopharmaceuticalInfo['00181074']),\r\n        radionuclideHalfLife: getNumberValue(radiopharmaceuticalInfo['00181075'])\r\n      }\r\n    };\r\n  }\r\n\r\n}\r\n\r\nexport default metaDataProvider;\r\n","function checkToken (token, data, dataOffset) {\r\n\r\n  if (dataOffset + token.length > data.length) {\r\n    return false;\r\n  }\r\n\r\n  let endIndex = dataOffset;\r\n\r\n  for (let i = 0; i < token.length; i++) {\r\n    if (token[i] !== data[endIndex++]) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nfunction stringToUint8Array (str) {\r\n  const uint = new Uint8Array(str.length);\r\n\r\n  for (let i = 0, j = str.length; i < j; i++) {\r\n    uint[i] = str.charCodeAt(i);\r\n  }\r\n\r\n  return uint;\r\n}\r\n\r\nfunction findIndexOfString (data, str, offset) {\r\n\r\n  offset = offset || 0;\r\n\r\n  const token = stringToUint8Array(str);\r\n\r\n  for (let i = offset; i < data.length; i++) {\r\n    if (token[0] === data[i]) {\r\n      // console.log('match @', i);\r\n      if (checkToken(token, data, i)) {\r\n        return i;\r\n      }\r\n    }\r\n  }\r\n\r\n  return -1;\r\n}\r\nexport default findIndexOfString;\r\n","let options = {\r\n  // callback allowing customization of the xhr (e.g. adding custom auth headers, cors, etc)\r\n  beforeSend (/* xhr, imageId */) {\r\n  },\r\n  // callback allowing modification of newly created image objects\r\n  imageCreated (/* image */) {\r\n  },\r\n  strict: false,\r\n  useWebWorkers: true,\r\n  decodeConfig: {\r\n    usePDFJS: false\r\n  }\r\n};\r\n\r\nexport function setOptions (newOptions) {\r\n  options = Object.assign(options, newOptions);\r\n}\r\n\r\nexport function getOptions () {\r\n  return options;\r\n}\r\n","import external from '../../externalModules.js';\r\nimport { getOptions } from './options.js';\r\n\r\nfunction xhrRequest (url, imageId, headers = {}, params = {}) {\r\n  const { cornerstone } = external;\r\n  const options = getOptions();\r\n\r\n  // Make the request for the DICOM P10 SOP Instance\r\n  return new Promise((resolve, reject) => {\r\n    const xhr = new XMLHttpRequest();\r\n\r\n    xhr.open('get', url, true);\r\n    xhr.responseType = 'arraybuffer';\r\n    options.beforeSend(xhr, imageId, headers, params);\r\n    Object.keys(headers).forEach(function (key) {\r\n      xhr.setRequestHeader(key, headers[key]);\r\n    });\r\n\r\n    params.deferred = {\r\n      resolve,\r\n      reject\r\n    };\r\n    params.url = url;\r\n    params.imageId = imageId;\r\n\r\n    // Event triggered when downloading an image starts\r\n    xhr.onloadstart = function (event) {\r\n      // Action\r\n      if (options.onloadstart) {\r\n        options.onloadstart(event, params);\r\n      }\r\n\r\n      // Event\r\n      const eventData = {\r\n        url,\r\n        imageId\r\n      };\r\n\r\n      cornerstone.triggerEvent(cornerstone.events, 'cornerstoneimageloadstart', eventData);\r\n    };\r\n\r\n    // Event triggered when downloading an image ends\r\n    xhr.onloadend = function (event) {\r\n      // Action\r\n      if (options.onloadend) {\r\n        options.onloadend(event, params);\r\n      }\r\n\r\n      const eventData = {\r\n        url,\r\n        imageId\r\n      };\r\n\r\n      // Event\r\n      cornerstone.triggerEvent(cornerstone.events, 'cornerstoneimageloadend', eventData);\r\n    };\r\n\r\n    // handle response data\r\n    xhr.onreadystatechange = function (event) {\r\n      // Action\r\n      if (options.onreadystatechange) {\r\n        options.onreadystatechange(event, params);\r\n\r\n        return;\r\n      }\r\n\r\n      // Default action\r\n      // TODO: consider sending out progress messages here as we receive the pixel data\r\n      if (xhr.readyState === 4) {\r\n        if (xhr.status === 200) {\r\n          resolve(xhr.response, xhr);\r\n        } else {\r\n          // request failed, reject the Promise\r\n          reject(xhr);\r\n        }\r\n      }\r\n    };\r\n\r\n    // Event triggered when downloading an image progresses\r\n    xhr.onprogress = function (oProgress) {\r\n      // console.log('progress:',oProgress)\r\n      const loaded = oProgress.loaded; // evt.loaded the bytes browser receive\r\n      let total;\r\n      let percentComplete;\r\n\r\n      if (oProgress.lengthComputable) {\r\n        total = oProgress.total; // evt.total the total bytes seted by the header\r\n        percentComplete = Math.round((loaded / total) * 100);\r\n      }\r\n\r\n      // Action\r\n      if (options.onprogress) {\r\n        options.onprogress(oProgress, params);\r\n      }\r\n\r\n      // Event\r\n      const eventData = {\r\n        url,\r\n        imageId,\r\n        loaded,\r\n        total,\r\n        percentComplete\r\n      };\r\n\r\n      cornerstone.triggerEvent(cornerstone.events, 'cornerstoneimageloadprogress', eventData);\r\n    };\r\n\r\n    xhr.onerror = function () {\r\n      reject(xhr);\r\n    };\r\n\r\n    xhr.onabort = function () {\r\n      reject(xhr);\r\n    };\r\n\r\n    xhr.send();\r\n  });\r\n}\r\n\r\nexport default xhrRequest;\r\n","import { default as xhrRequest } from './xhrRequest.js';\r\nimport { setOptions, getOptions } from './options.js';\r\n\r\nconst internal = {\r\n  xhrRequest,\r\n  setOptions,\r\n  getOptions\r\n};\r\n\r\nexport { setOptions, getOptions, xhrRequest, internal };\r\n","import { xhrRequest } from '../internal/index.js';\r\nimport findIndexOfString from './findIndexOfString.js';\r\n\r\nfunction findBoundary (header) {\r\n  for (let i = 0; i < header.length; i++) {\r\n    if (header[i].substr(0, 2) === '--') {\r\n      return header[i];\r\n    }\r\n  }\r\n}\r\n\r\nfunction findContentType (header) {\r\n  for (let i = 0; i < header.length; i++) {\r\n    if (header[i].substr(0, 13) === 'Content-Type:') {\r\n      return header[i].substr(13).trim();\r\n    }\r\n  }\r\n}\r\n\r\nfunction uint8ArrayToString (data, offset, length) {\r\n  offset = offset || 0;\r\n  length = length || data.length - offset;\r\n  let str = '';\r\n\r\n  for (let i = offset; i < offset + length; i++) {\r\n    str += String.fromCharCode(data[i]);\r\n  }\r\n\r\n  return str;\r\n}\r\n\r\nfunction getPixelData (uri, imageId, mediaType = 'application/octet-stream') {\r\n  const headers = {\r\n    accept: mediaType\r\n  };\r\n\r\n  return new Promise((resolve, reject) => {\r\n    const loadPromise = xhrRequest(uri, imageId, headers);\r\n\r\n    loadPromise.then(function (imageFrameAsArrayBuffer/* , xhr*/) {\r\n\r\n      // request succeeded, Parse the multi-part mime response\r\n      const response = new Uint8Array(imageFrameAsArrayBuffer);\r\n\r\n      // First look for the multipart mime header\r\n      const tokenIndex = findIndexOfString(response, '\\r\\n\\r\\n');\r\n\r\n      if (tokenIndex === -1) {\r\n        reject(new Error('invalid response - no multipart mime header'));\r\n      }\r\n      const header = uint8ArrayToString(response, 0, tokenIndex);\r\n      // Now find the boundary  marker\r\n      const split = header.split('\\r\\n');\r\n      const boundary = findBoundary(split);\r\n\r\n      if (!boundary) {\r\n        reject(new Error('invalid response - no boundary marker'));\r\n      }\r\n      const offset = tokenIndex + 4; // skip over the \\r\\n\\r\\n\r\n\r\n      // find the terminal boundary marker\r\n      const endIndex = findIndexOfString(response, boundary, offset);\r\n\r\n      if (endIndex === -1) {\r\n        reject(new Error('invalid response - terminating boundary not found'));\r\n      }\r\n\r\n      // Remove \\r\\n from the length\r\n      const length = endIndex - offset - 2;\r\n\r\n      // return the info for this pixel data\r\n      resolve({\r\n        contentType: findContentType(split),\r\n        imageFrame: {\r\n          pixelData: new Uint8Array(imageFrameAsArrayBuffer, offset, length)\r\n        }\r\n      });\r\n    }, reject);\r\n  });\r\n}\r\n\r\nexport default getPixelData;\r\n","import external from '../externalModules.js';\r\n\r\nfunction getImageFrame (imageId) {\r\n  const { cornerstone } = external;\r\n  const imagePixelModule = cornerstone.metaData.get('imagePixelModule', imageId);\r\n\r\n  return {\r\n    samplesPerPixel: imagePixelModule.samplesPerPixel,\r\n    photometricInterpretation: imagePixelModule.photometricInterpretation,\r\n    planarConfiguration: imagePixelModule.planarConfiguration,\r\n    rows: imagePixelModule.rows,\r\n    columns: imagePixelModule.columns,\r\n    bitsAllocated: imagePixelModule.bitsAllocated,\r\n    bitsStored: imagePixelModule.bitsStored,\r\n    pixelRepresentation: imagePixelModule.pixelRepresentation, // 0 = unsigned,\r\n    smallestPixelValue: imagePixelModule.smallestPixelValue,\r\n    largestPixelValue: imagePixelModule.largestPixelValue,\r\n    redPaletteColorLookupTableDescriptor: imagePixelModule.redPaletteColorLookupTableDescriptor,\r\n    greenPaletteColorLookupTableDescriptor: imagePixelModule.greenPaletteColorLookupTableDescriptor,\r\n    bluePaletteColorLookupTableDescriptor: imagePixelModule.bluePaletteColorLookupTableDescriptor,\r\n    redPaletteColorLookupTableData: imagePixelModule.redPaletteColorLookupTableData,\r\n    greenPaletteColorLookupTableData: imagePixelModule.greenPaletteColorLookupTableData,\r\n    bluePaletteColorLookupTableData: imagePixelModule.bluePaletteColorLookupTableData,\r\n    pixelData: undefined // populated later after decoding\r\n  };\r\n}\r\n\r\nexport default getImageFrame;\r\n","import { getOptions } from './internal/options.js';\r\n\r\n// the taskId to assign to the next task added via addTask()\r\nlet nextTaskId = 0;\r\n\r\n// array of queued tasks sorted with highest priority task first\r\nconst tasks = [];\r\n\r\n// array of web workers to dispatch decode tasks to\r\nconst webWorkers = [];\r\n\r\n// The options for CornerstoneWADOImageLoader\r\nconst options = getOptions();\r\n\r\nconst defaultConfig = {\r\n  maxWebWorkers: navigator.hardwareConcurrency || 1,\r\n  startWebWorkersOnDemand: true,\r\n  webWorkerPath: '../../dist/cornerstoneWADOImageLoaderWebWorker.js',\r\n  webWorkerTaskPaths: [],\r\n  taskConfiguration: {\r\n    decodeTask: {\r\n      loadCodecsOnStartup: true,\r\n      initializeCodecsOnStartup: false,\r\n      codecsPath: '../dist/cornerstoneWADOImageLoaderCodecs.js',\r\n      usePDFJS: false,\r\n      strict: options.strict\r\n    }\r\n  }\r\n};\r\n\r\nlet config;\r\n\r\nconst statistics = {\r\n  maxWebWorkers: 0,\r\n  numWebWorkers: 0,\r\n  numTasksQueued: 0,\r\n  numTasksExecuting: 0,\r\n  numTasksCompleted: 0,\r\n  totalTaskTimeInMS: 0,\r\n  totalTimeDelayedInMS: 0\r\n};\r\n\r\n/**\r\n * Function to start a task on a web worker\r\n */\r\nfunction startTaskOnWebWorker () {\r\n  // return immediately if no decode tasks to do\r\n  if (!tasks.length) {\r\n    return;\r\n  }\r\n\r\n  // look for a web worker that is ready\r\n  for (let i = 0; i < webWorkers.length; i++) {\r\n    if (webWorkers[i].status === 'ready') {\r\n      // mark it as busy so tasks are not assigned to it\r\n      webWorkers[i].status = 'busy';\r\n\r\n      // get the highest priority task\r\n      const task = tasks.shift();\r\n\r\n      task.start = new Date().getTime();\r\n\r\n      // update stats with how long this task was delayed (waiting in queue)\r\n      const end = new Date().getTime();\r\n\r\n      statistics.totalTimeDelayedInMS += end - task.added;\r\n\r\n      // assign this task to this web worker and send the web worker\r\n      // a message to execute it\r\n      webWorkers[i].task = task;\r\n      webWorkers[i].worker.postMessage({\r\n        taskType: task.taskType,\r\n        workerIndex: i,\r\n        data: task.data\r\n      }, task.transferList);\r\n      statistics.numTasksExecuting++;\r\n\r\n      return;\r\n    }\r\n  }\r\n\r\n  // if no available web workers and we haven't started max web workers, start a new one\r\n  if (webWorkers.length < config.maxWebWorkers) {\r\n    spawnWebWorker();\r\n  }\r\n}\r\n\r\n/**\r\n * Function to handle a message from a web worker\r\n * @param msg\r\n */\r\nfunction handleMessageFromWorker (msg) {\r\n  // console.log('handleMessageFromWorker', msg.data);\r\n  if (msg.data.taskType === 'initialize') {\r\n    webWorkers[msg.data.workerIndex].status = 'ready';\r\n    startTaskOnWebWorker();\r\n  } else {\r\n    const start = webWorkers[msg.data.workerIndex].task.start;\r\n\r\n    webWorkers[msg.data.workerIndex].task.deferred.resolve(msg.data.result);\r\n    webWorkers[msg.data.workerIndex].task = undefined;\r\n\r\n    statistics.numTasksExecuting--;\r\n    webWorkers[msg.data.workerIndex].status = 'ready';\r\n    statistics.numTasksCompleted++;\r\n\r\n    const end = new Date().getTime();\r\n\r\n    statistics.totalTaskTimeInMS += end - start;\r\n\r\n    startTaskOnWebWorker();\r\n  }\r\n}\r\n\r\n/**\r\n * Spawns a new web worker\r\n */\r\nfunction spawnWebWorker () {\r\n  // prevent exceeding maxWebWorkers\r\n  if (webWorkers.length >= config.maxWebWorkers) {\r\n    return;\r\n  }\r\n\r\n  // spawn the webworker\r\n  const worker = new Worker(config.webWorkerPath);\r\n\r\n  webWorkers.push({\r\n    worker,\r\n    status: 'initializing'\r\n  });\r\n  worker.addEventListener('message', handleMessageFromWorker);\r\n  worker.postMessage({\r\n    taskType: 'initialize',\r\n    workerIndex: webWorkers.length - 1,\r\n    config\r\n  });\r\n}\r\n\r\n/**\r\n * Initialization function for the web worker manager - spawns web workers\r\n * @param configObject\r\n */\r\nfunction initialize (configObject) {\r\n  configObject = configObject || defaultConfig;\r\n\r\n  // prevent being initialized more than once\r\n  if (config) {\r\n    throw new Error('WebWorkerManager already initialized');\r\n  }\r\n\r\n  config = configObject;\r\n\r\n  config.maxWebWorkers = config.maxWebWorkers || (navigator.hardwareConcurrency || 1);\r\n\r\n  // Spawn new web workers\r\n  if (!config.startWebWorkersOnDemand) {\r\n    for (let i = 0; i < config.maxWebWorkers; i++) {\r\n      spawnWebWorker();\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * dynamically loads a web worker task\r\n * @param sourcePath\r\n * @param taskConfig\r\n */\r\nfunction loadWebWorkerTask (sourcePath, taskConfig) {\r\n  // add it to the list of web worker tasks paths so on demand web workers\r\n  // load this properly\r\n  config.webWorkerTaskPaths.push(sourcePath);\r\n\r\n  // if a task specific configuration is provided, merge it into the config\r\n  if (taskConfig) {\r\n    config.taskConfiguration = Object.assign(config.taskConfiguration, taskConfig);\r\n  }\r\n\r\n  // tell each spawned web worker to load this task\r\n  for (let i = 0; i < webWorkers.length; i++) {\r\n    webWorkers[i].worker.postMessage({\r\n      taskType: 'loadWebWorkerTask',\r\n      workerIndex: webWorkers.length - 1,\r\n      sourcePath,\r\n      config\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Function to add a decode task to be performed\r\n *\r\n * @param taskType - the taskType for this task\r\n * @param data - data specific to the task\r\n * @param priority - optional priority of the task (defaults to 0), > 0 is higher, < 0 is lower\r\n * @param transferList - optional array of data to transfer to web worker\r\n * @returns {*}\r\n */\r\nfunction addTask (taskType, data, priority = 0, transferList) {\r\n  if (!config) {\r\n    initialize();\r\n  }\r\n\r\n  let deferred = {};\r\n  const promise = new Promise((resolve, reject) => {\r\n    deferred = {\r\n      resolve,\r\n      reject\r\n    };\r\n  });\r\n\r\n  // find the right spot to insert this decode task (based on priority)\r\n  let i;\r\n\r\n  for (i = 0; i < tasks.length; i++) {\r\n    if (tasks[i].priority < priority) {\r\n      break;\r\n    }\r\n  }\r\n\r\n  const taskId = nextTaskId++;\r\n\r\n  // insert the decode task at position i\r\n  tasks.splice(i, 0, {\r\n    taskId,\r\n    taskType,\r\n    status: 'ready',\r\n    added: new Date().getTime(),\r\n    data,\r\n    deferred,\r\n    priority,\r\n    transferList\r\n  });\r\n\r\n  // try to start a task on the web worker since we just added a new task and a web worker may be available\r\n  startTaskOnWebWorker();\r\n\r\n  return {\r\n    taskId,\r\n    promise\r\n  };\r\n}\r\n\r\n/**\r\n * Changes the priority of a queued task\r\n * @param taskId - the taskId to change the priority of\r\n * @param priority - priority of the task (defaults to 0), > 0 is higher, < 0 is lower\r\n * @returns boolean - true on success, false if taskId not found\r\n */\r\nfunction setTaskPriority (taskId, priority = 0) {\r\n  // search for this taskId\r\n  for (let i = 0; i < tasks.length; i++) {\r\n    if (tasks[i].taskId === taskId) {\r\n      // taskId found, remove it\r\n      const task = tasks.splice(i, 1)[0];\r\n\r\n      // set its priority\r\n      task.priority = priority;\r\n\r\n      // find the right spot to insert this decode task (based on priority)\r\n      for (i = 0; i < tasks.length; i++) {\r\n        if (tasks[i].priority < priority) {\r\n          break;\r\n        }\r\n      }\r\n\r\n      // insert the decode task at position i\r\n      tasks.splice(i, 0, task);\r\n\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\n/**\r\n * Cancels a queued task and rejects\r\n * @param taskId - the taskId to cancel\r\n * @param reason - optional reason the task was rejected\r\n * @returns boolean - true on success, false if taskId not found\r\n */\r\nfunction cancelTask (taskId, reason) {\r\n  // search for this taskId\r\n  for (let i = 0; i < tasks.length; i++) {\r\n    if (tasks[i].taskId === taskId) {\r\n      // taskId found, remove it\r\n      const task = tasks.splice(i, 1);\r\n\r\n      task.deferred.reject(reason);\r\n\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\n/**\r\n * Function to return the statistics on running web workers\r\n * @returns object containing statistics\r\n */\r\nfunction getStatistics () {\r\n  statistics.maxWebWorkers = config.maxWebWorkers;\r\n  statistics.numWebWorkers = webWorkers.length;\r\n  statistics.numTasksQueued = tasks.length;\r\n\r\n  return statistics;\r\n}\r\n\r\nexport default {\r\n  initialize,\r\n  loadWebWorkerTask,\r\n  addTask,\r\n  getStatistics,\r\n  setTaskPriority,\r\n  cancelTask\r\n};\r\n","import getMinMax from '../shared/getMinMax.js';\r\n\r\n/**\r\n * Special decoder for 8 bit jpeg that leverages the browser's built in JPEG decoder for increased performance\r\n */\r\n\r\nfunction arrayBufferToString (buffer) {\r\n  return binaryToString(String.fromCharCode.apply(null, Array.prototype.slice.apply(new Uint8Array(buffer))));\r\n}\r\n\r\nfunction binaryToString (binary) {\r\n  let error;\r\n\r\n  try {\r\n    return decodeURIComponent(escape(binary));\r\n  } catch (_error) {\r\n    error = _error;\r\n    if (error instanceof URIError) {\r\n      return binary;\r\n    }\r\n    throw error;\r\n\r\n  }\r\n}\r\n\r\nfunction decodeJPEGBaseline8BitColor (imageFrame, pixelData, canvas) {\r\n  const start = new Date().getTime();\r\n  const imgBlob = new Blob([pixelData], { type: 'image/jpeg' });\r\n\r\n  return new Promise((resolve, reject) => {\r\n    const fileReader = new FileReader();\r\n\r\n    if (fileReader.readAsBinaryString === undefined) {\r\n      fileReader.readAsArrayBuffer(imgBlob);\r\n    } else {\r\n      fileReader.readAsBinaryString(imgBlob); // doesn't work on IE11\r\n    }\r\n\r\n    fileReader.onload = function () {\r\n      const img = new Image();\r\n\r\n      img.onload = function () {\r\n        canvas.height = img.height;\r\n        canvas.width = img.width;\r\n        imageFrame.rows = img.height;\r\n        imageFrame.columns = img.width;\r\n        const context = canvas.getContext('2d');\r\n\r\n        context.drawImage(this, 0, 0);\r\n        const imageData = context.getImageData(0, 0, img.width, img.height);\r\n        const end = new Date().getTime();\r\n\r\n        imageFrame.pixelData = imageData.data;\r\n        imageFrame.imageData = imageData;\r\n        imageFrame.decodeTimeInMS = end - start;\r\n\r\n        // calculate smallest and largest PixelValue\r\n        const minMax = getMinMax(imageFrame.pixelData);\r\n\r\n        imageFrame.smallestPixelValue = minMax.min;\r\n        imageFrame.largestPixelValue = minMax.max;\r\n\r\n        resolve(imageFrame);\r\n      };\r\n\r\n      img.onerror = function (error) {\r\n        reject(error);\r\n      };\r\n\r\n      if (fileReader.readAsBinaryString === undefined) {\r\n        img.src = `data:image/jpeg;base64,${window.btoa(arrayBufferToString(fileReader.result))}`;\r\n      } else {\r\n        img.src = `data:image/jpeg;base64,${window.btoa(fileReader.result)}`; // doesn't work on IE11\r\n      }\r\n    };\r\n\r\n    fileReader.onerror = (e) => {\r\n      reject(e);\r\n    };\r\n  });\r\n}\r\n\r\nexport default decodeJPEGBaseline8BitColor;\r\n","import { getOptions } from './internal/options.js';\r\nimport webWorkerManager from './webWorkerManager.js';\r\nimport decodeJPEGBaseline8BitColor from './decodeJPEGBaseline8BitColor.js';\r\nimport { default as decodeImageFrameHandler } from '../shared/decodeImageFrame.js';\r\nimport calculateMinMax from '../shared/calculateMinMax.js';\r\nimport { initializeJPEG2000 } from '../shared/decoders/decodeJPEG2000.js';\r\nimport { initializeJPEGLS } from '../shared/decoders/decodeJPEGLS.js';\r\n\r\nlet codecsInitialized = false;\r\n\r\nfunction processDecodeTask (imageFrame, transferSyntax, pixelData, options) {\r\n  const priority = options.priority || undefined;\r\n  const transferList = options.transferPixelData ? [pixelData.buffer] : undefined;\r\n  const loaderOptions = getOptions();\r\n  const { strict, decodeConfig, useWebWorkers } = loaderOptions;\r\n\r\n  if (useWebWorkers === false) {\r\n    if (codecsInitialized === false) {\r\n      initializeJPEG2000(decodeConfig);\r\n      initializeJPEGLS(decodeConfig);\r\n\r\n      codecsInitialized = true;\r\n    }\r\n\r\n    return new Promise((resolve, reject) => {\r\n      try {\r\n        const decodeArguments = [imageFrame, transferSyntax, pixelData, decodeConfig, options];\r\n        const decodedImageFrame = decodeImageFrameHandler(...decodeArguments);\r\n\r\n        calculateMinMax(decodedImageFrame, strict);\r\n\r\n        resolve(decodedImageFrame);\r\n      } catch (error) {\r\n        reject(error);\r\n      }\r\n    });\r\n  }\r\n\r\n  return webWorkerManager.addTask(\r\n    'decodeTask',\r\n    {\r\n      imageFrame,\r\n      transferSyntax,\r\n      pixelData,\r\n      options\r\n    }, priority, transferList).promise;\r\n}\r\n\r\nfunction decodeImageFrame (imageFrame, transferSyntax, pixelData, canvas, options = {}) {\r\n  // TODO: Turn this into a switch statement instead\r\n  if (transferSyntax === '1.2.840.10008.1.2') {\r\n    // Implicit VR Little Endian\r\n    return processDecodeTask(imageFrame, transferSyntax, pixelData, options);\r\n  } else if (transferSyntax === '1.2.840.10008.1.2.1') {\r\n    // Explicit VR Little Endian\r\n    return processDecodeTask(imageFrame, transferSyntax, pixelData, options);\r\n  } else if (transferSyntax === '1.2.840.10008.1.2.2') {\r\n    // Explicit VR Big Endian (retired)\r\n    return processDecodeTask(imageFrame, transferSyntax, pixelData, options);\r\n  } else if (transferSyntax === '1.2.840.10008.1.2.1.99') {\r\n    // Deflate transfer syntax (deflated by dicomParser)\r\n    return processDecodeTask(imageFrame, transferSyntax, pixelData, options);\r\n  } else if (transferSyntax === '1.2.840.10008.1.2.5') {\r\n    // RLE Lossless\r\n    return processDecodeTask(imageFrame, transferSyntax, pixelData, options);\r\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.50') {\r\n    // JPEG Baseline lossy process 1 (8 bit)\r\n\r\n    // Handle 8-bit JPEG Baseline color images using the browser's built-in\r\n    // JPEG decoding\r\n    if (imageFrame.bitsAllocated === 8 &&\r\n       (imageFrame.samplesPerPixel === 3 || imageFrame.samplesPerPixel === 4)) {\r\n      return decodeJPEGBaseline8BitColor(imageFrame, pixelData, canvas);\r\n    }\r\n\r\n    return processDecodeTask(imageFrame, transferSyntax, pixelData, options);\r\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.51') {\r\n    // JPEG Baseline lossy process 2 & 4 (12 bit)\r\n    return processDecodeTask(imageFrame, transferSyntax, pixelData, options);\r\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.57') {\r\n    // JPEG Lossless, Nonhierarchical (Processes 14)\r\n    return processDecodeTask(imageFrame, transferSyntax, pixelData, options);\r\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.70') {\r\n    // JPEG Lossless, Nonhierarchical (Processes 14 [Selection 1])\r\n    return processDecodeTask(imageFrame, transferSyntax, pixelData, options);\r\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.80') {\r\n    // JPEG-LS Lossless Image Compression\r\n    return processDecodeTask(imageFrame, transferSyntax, pixelData, options);\r\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.81') {\r\n    // JPEG-LS Lossy (Near-Lossless) Image Compression\r\n    return processDecodeTask(imageFrame, transferSyntax, pixelData, options);\r\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.90') {\r\n    // JPEG 2000 Lossless\r\n    return processDecodeTask(imageFrame, transferSyntax, pixelData, options);\r\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.91') {\r\n    // JPEG 2000 Lossy\r\n    return processDecodeTask(imageFrame, transferSyntax, pixelData, options);\r\n  }\r\n\r\n  /* Don't know if these work...\r\n   // JPEG 2000 Part 2 Multicomponent Image Compression (Lossless Only)\r\n   else if(transferSyntax === \"1.2.840.10008.1.2.4.92\")\r\n   {\r\n   return cornerstoneWADOImageLoader.decodeJPEG2000(dataSet, frame);\r\n   }\r\n   // JPEG 2000 Part 2 Multicomponent Image Compression\r\n   else if(transferSyntax === \"1.2.840.10008.1.2.4.93\")\r\n   {\r\n   return cornerstoneWADOImageLoader.decodeJPEG2000(dataSet, frame);\r\n   }\r\n   */\r\n\r\n  return new Promise((resolve, reject) => {\r\n    reject(new Error(`No decoder for transfer syntax ${transferSyntax}`));\r\n  });\r\n}\r\n\r\nexport default decodeImageFrame;\r\n","export default function (photoMetricInterpretation) {\r\n  return (photoMetricInterpretation === 'RGB' ||\r\n    photoMetricInterpretation === 'PALETTE COLOR' ||\r\n    photoMetricInterpretation === 'YBR_FULL' ||\r\n    photoMetricInterpretation === 'YBR_FULL_422' ||\r\n    photoMetricInterpretation === 'YBR_PARTIAL_422' ||\r\n    photoMetricInterpretation === 'YBR_PARTIAL_420' ||\r\n    photoMetricInterpretation === 'YBR_RCT' ||\r\n    photoMetricInterpretation === 'YBR_ICT');\r\n}\r\n","import { convertRGBColorByPixel, convertRGBColorByPlane,\r\n  convertYBRFullByPixel, convertYBRFullByPlane,\r\n  convertPALETTECOLOR } from './colorSpaceConverters/index.js';\r\n\r\nfunction convertRGB (imageFrame, rgbaBuffer) {\r\n  if (imageFrame.planarConfiguration === 0) {\r\n    convertRGBColorByPixel(imageFrame.pixelData, rgbaBuffer);\r\n  } else {\r\n    convertRGBColorByPlane(imageFrame.pixelData, rgbaBuffer);\r\n  }\r\n}\r\n\r\nfunction convertYBRFull (imageFrame, rgbaBuffer) {\r\n  if (imageFrame.planarConfiguration === 0) {\r\n    convertYBRFullByPixel(imageFrame.pixelData, rgbaBuffer);\r\n  } else {\r\n    convertYBRFullByPlane(imageFrame.pixelData, rgbaBuffer);\r\n  }\r\n}\r\n\r\nexport default function convertColorSpace (imageFrame, imageData) {\r\n  const rgbaBuffer = imageData.data;\r\n  // convert based on the photometric interpretation\r\n\r\n  if (imageFrame.photometricInterpretation === 'RGB') {\r\n    convertRGB(imageFrame, rgbaBuffer);\r\n  } else if (imageFrame.photometricInterpretation === 'YBR_RCT') {\r\n    convertRGB(imageFrame, rgbaBuffer);\r\n  } else if (imageFrame.photometricInterpretation === 'YBR_ICT') {\r\n    convertRGB(imageFrame, rgbaBuffer);\r\n  } else if (imageFrame.photometricInterpretation === 'PALETTE COLOR') {\r\n    convertPALETTECOLOR(imageFrame, rgbaBuffer);\r\n  } else if (imageFrame.photometricInterpretation === 'YBR_FULL_422') {\r\n    convertRGB(imageFrame, rgbaBuffer);\r\n  } else if (imageFrame.photometricInterpretation === 'YBR_FULL') {\r\n    convertYBRFull(imageFrame, rgbaBuffer);\r\n  } else {\r\n    throw new Error(`No color space conversion for photometric interpretation ${imageFrame.photometricInterpretation}`);\r\n  }\r\n}\r\n","function isJPEGBaseline8BitColor (imageFrame, transferSyntax) {\r\n  transferSyntax = transferSyntax || imageFrame.transferSyntax;\r\n\r\n  if (imageFrame.bitsAllocated === 8 &&\r\n     transferSyntax === '1.2.840.10008.1.2.4.50' &&\r\n     (imageFrame.samplesPerPixel === 3 || imageFrame.samplesPerPixel === 4)) {\r\n    return true;\r\n  }\r\n}\r\n\r\nexport default isJPEGBaseline8BitColor;\r\n","import external from '../externalModules.js';\r\nimport getImageFrame from './getImageFrame.js';\r\nimport decodeImageFrame from './decodeImageFrame.js';\r\nimport isColorImageFn from './isColorImage.js';\r\nimport convertColorSpace from './convertColorSpace.js';\r\nimport getMinMax from '../shared/getMinMax.js';\r\nimport isJPEGBaseline8BitColor from './isJPEGBaseline8BitColor.js';\r\n\r\nlet lastImageIdDrawn = '';\r\n\r\nfunction isModalityLUTForDisplay (sopClassUid) {\r\n  // special case for XA and XRF\r\n  // https://groups.google.com/forum/#!searchin/comp.protocols.dicom/Modality$20LUT$20XA/comp.protocols.dicom/UBxhOZ2anJ0/D0R_QP8V2wIJ\r\n  return sopClassUid !== '1.2.840.10008.5.1.4.1.1.12.1' && // XA\r\n         sopClassUid !== '1.2.840.10008.5.1.4.1.1.12.2.1'; // XRF\r\n}\r\n\r\nfunction convertToIntPixelData (floatPixelData) {\r\n  const floatMinMax = getMinMax(floatPixelData);\r\n  const floatRange = Math.abs(floatMinMax.max - floatMinMax.min);\r\n  const intRange = 65535;\r\n  const slope = floatRange / intRange;\r\n  const intercept = floatMinMax.min;\r\n  const numPixels = floatPixelData.length;\r\n  const intPixelData = new Uint16Array(numPixels);\r\n  let min = 65535;\r\n  let max = 0;\r\n\r\n  for (let i = 0; i < numPixels; i++) {\r\n    const rescaledPixel = Math.floor((floatPixelData[i] - intercept) / slope);\r\n\r\n    intPixelData[i] = rescaledPixel;\r\n    min = Math.min(min, rescaledPixel);\r\n    max = Math.max(max, rescaledPixel);\r\n  }\r\n\r\n  return {\r\n    min,\r\n    max,\r\n    intPixelData,\r\n    slope,\r\n    intercept\r\n  };\r\n}\r\n\r\n/**\r\n * Helper function to set pixel data to the right typed array.  This is needed because web workers\r\n * can transfer array buffers but not typed arrays\r\n * @param imageFrame\r\n */\r\nfunction setPixelDataType (imageFrame) {\r\n  if (imageFrame.bitsAllocated === 32) {\r\n    imageFrame.pixelData = new Float32Array(imageFrame.pixelData);\r\n  } else if (imageFrame.bitsAllocated === 16) {\r\n    if (imageFrame.pixelRepresentation === 0) {\r\n      imageFrame.pixelData = new Uint16Array(imageFrame.pixelData);\r\n    } else {\r\n      imageFrame.pixelData = new Int16Array(imageFrame.pixelData);\r\n    }\r\n  } else {\r\n    imageFrame.pixelData = new Uint8Array(imageFrame.pixelData);\r\n  }\r\n}\r\n\r\nfunction createImage (imageId, pixelData, transferSyntax, options) {\r\n\r\n  if (!pixelData || !pixelData.length) {\r\n    return Promise.reject(new Error('The file does not contain image data.'));\r\n  }\r\n\r\n  const { cornerstone } = external;\r\n  const canvas = document.createElement('canvas');\r\n  const imageFrame = getImageFrame(imageId);\r\n  const decodePromise = decodeImageFrame(imageFrame, transferSyntax, pixelData, canvas, options);\r\n\r\n  return new Promise((resolve, reject) => {\r\n    decodePromise.then(function (imageFrame) {\r\n      const imagePlaneModule = cornerstone.metaData.get('imagePlaneModule', imageId) || {};\r\n      const voiLutModule = cornerstone.metaData.get('voiLutModule', imageId) || {};\r\n      const modalityLutModule = cornerstone.metaData.get('modalityLutModule', imageId) || {};\r\n      const sopCommonModule = cornerstone.metaData.get('sopCommonModule', imageId) || {};\r\n      const isColorImage = isColorImageFn(imageFrame.photometricInterpretation);\r\n\r\n      // JPEGBaseline (8 bits) is already returning the pixel data in the right format (rgba)\r\n      // because it's using a canvas to load and decode images.\r\n      if (!isJPEGBaseline8BitColor(imageFrame, transferSyntax)) {\r\n        setPixelDataType(imageFrame);\r\n\r\n        // convert color space\r\n        if (isColorImage) {\r\n          // setup the canvas context\r\n          canvas.height = imageFrame.rows;\r\n          canvas.width = imageFrame.columns;\r\n\r\n          const context = canvas.getContext('2d');\r\n          const imageData = context.createImageData(imageFrame.columns, imageFrame.rows);\r\n\r\n          convertColorSpace(imageFrame, imageData);\r\n          imageFrame.imageData = imageData;\r\n          imageFrame.pixelData = imageData.data;\r\n\r\n          // calculate smallest and largest PixelValue of the converted pixelData\r\n          const minMax = getMinMax(imageFrame.pixelData);\r\n\r\n          imageFrame.smallestPixelValue = minMax.min;\r\n          imageFrame.largestPixelValue = minMax.max;\r\n        }\r\n      }\r\n\r\n      const image = {\r\n        imageId,\r\n        color: isColorImage,\r\n        columnPixelSpacing: imagePlaneModule.columnPixelSpacing,\r\n        columns: imageFrame.columns,\r\n        height: imageFrame.rows,\r\n        intercept: modalityLutModule.rescaleIntercept ? modalityLutModule.rescaleIntercept : 0,\r\n        invert: imageFrame.photometricInterpretation === 'MONOCHROME1',\r\n        minPixelValue: imageFrame.smallestPixelValue,\r\n        maxPixelValue: imageFrame.largestPixelValue,\r\n        rowPixelSpacing: imagePlaneModule.rowPixelSpacing,\r\n        rows: imageFrame.rows,\r\n        sizeInBytes: imageFrame.pixelData.length,\r\n        slope: modalityLutModule.rescaleSlope ? modalityLutModule.rescaleSlope : 1,\r\n        width: imageFrame.columns,\r\n        windowCenter: voiLutModule.windowCenter ? voiLutModule.windowCenter[0] : undefined,\r\n        windowWidth: voiLutModule.windowWidth ? voiLutModule.windowWidth[0] : undefined,\r\n        decodeTimeInMS: imageFrame.decodeTimeInMS,\r\n        floatPixelData: undefined\r\n      };\r\n\r\n      // add function to return pixel data\r\n      if (imageFrame.pixelData instanceof Float32Array) {\r\n        const floatPixelData = imageFrame.pixelData;\r\n        const results = convertToIntPixelData(floatPixelData);\r\n\r\n        image.minPixelValue = results.min;\r\n        image.maxPixelValue = results.max;\r\n        image.slope = results.slope;\r\n        image.intercept = results.intercept;\r\n        image.floatPixelData = floatPixelData;\r\n        image.getPixelData = () => results.intPixelData;\r\n      } else {\r\n        image.getPixelData = () => imageFrame.pixelData;\r\n      }\r\n\r\n      if (image.color) {\r\n        image.getCanvas = function () {\r\n          if (lastImageIdDrawn === imageId) {\r\n            return canvas;\r\n          }\r\n\r\n          canvas.height = image.rows;\r\n          canvas.width = image.columns;\r\n          const context = canvas.getContext('2d');\r\n\r\n          context.putImageData(imageFrame.imageData, 0, 0);\r\n          lastImageIdDrawn = imageId;\r\n\r\n          return canvas;\r\n        };\r\n      }\r\n\r\n      // Modality LUT\r\n      if (modalityLutModule.modalityLUTSequence &&\r\n        modalityLutModule.modalityLUTSequence.length > 0 &&\r\n        isModalityLUTForDisplay(sopCommonModule.sopClassUID)) {\r\n        image.modalityLUT = modalityLutModule.modalityLUTSequence[0];\r\n      }\r\n\r\n      // VOI LUT\r\n      if (voiLutModule.voiLUTSequence &&\r\n        voiLutModule.voiLUTSequence.length > 0) {\r\n        image.voiLUT = voiLutModule.voiLUTSequence[0];\r\n      }\r\n\r\n      if (image.color) {\r\n        image.windowWidth = 255;\r\n        image.windowCenter = 127;\r\n      }\r\n\r\n      // set the ww/wc to cover the dynamic range of the image if no values are supplied\r\n      if (image.windowCenter === undefined || image.windowWidth === undefined) {\r\n        const maxVoi = image.maxPixelValue * image.slope + image.intercept;\r\n        const minVoi = image.minPixelValue * image.slope + image.intercept;\r\n\r\n        image.windowWidth = maxVoi - minVoi;\r\n        image.windowCenter = (maxVoi + minVoi) / 2;\r\n      }\r\n      resolve(image);\r\n    }, reject);\r\n  });\r\n}\r\n\r\nexport default createImage;\r\n","import metaDataManager from './metaDataManager.js';\r\nimport getPixelData from './getPixelData.js';\r\nimport createImage from '../createImage.js';\r\n\r\n/**\r\n * Helper method to extract the transfer-syntax from the response of the server.\r\n * @param {string} contentType The value of the content-type header as returned by the WADO-RS server.\r\n * @return The transfer-syntax as announced by the server, or Implicit Little Endian by default.\r\n */\r\nexport function getTransferSyntaxForContentType (contentType) {\r\n  const defaultTransferSyntax = '1.2.840.10008.1.2'; // Default is Implicit Little Endian.\r\n\r\n  if (!contentType) {\r\n    return defaultTransferSyntax;\r\n  }\r\n\r\n  // Browse through the content type parameters\r\n  const parameters = contentType.split(';');\r\n  const params = {};\r\n\r\n  parameters.forEach((parameter) => {\r\n    // Look for a transfer-syntax=XXXX pair\r\n    const parameterValues = parameter.split('=');\r\n\r\n    if (parameterValues.length !== 2) {\r\n      return;\r\n    }\r\n\r\n    const value = parameterValues[1].trim().replace(/\"/g, '');\r\n\r\n    params[parameterValues[0].trim()] = value;\r\n  });\r\n\r\n  // This is useful if the PACS doesn't respond with a syntax\r\n  // in the content type.\r\n  // http://dicom.nema.org/medical/dicom/current/output/chtml/part18/chapter_6.html#table_6.1.1.8-3b\r\n  const defaultTransferSyntaxByType = {\r\n    'image/jpeg': '1.2.840.10008.1.2.4.70',\r\n    'image/x-dicom-rle': '1.2.840.10008.1.2.5',\r\n    'image/x-jls': '1.2.840.10008.1.2.4.80',\r\n    'image/jp2': '1.2.840.10008.1.2.4.90',\r\n    'image/jpx': '1.2.840.10008.1.2.4.92'\r\n  };\r\n\r\n  if (params['transfer-syntax']) {\r\n    return params['transfer-syntax'];\r\n  } else if (contentType && !Object.keys(params).length && defaultTransferSyntaxByType[contentType]) {\r\n    // dcm4che seems to be reporting the content type as just 'image/jp2'?\r\n    return defaultTransferSyntaxByType[contentType];\r\n  } else if (params.type && defaultTransferSyntaxByType[params.type]) {\r\n    return defaultTransferSyntaxByType[params.type];\r\n  }\r\n\r\n  return defaultTransferSyntax;\r\n}\r\n\r\nfunction loadImage (imageId, options) {\r\n  const start = new Date().getTime();\r\n  const uri = imageId.substring(7);\r\n\r\n  const promise = new Promise((resolve, reject) => {\r\n    // check to make sure we have metadata for this imageId\r\n    const metaData = metaDataManager.get(imageId);\r\n\r\n    if (metaData === undefined) {\r\n      const error = new Error(`no metadata for imageId ${imageId}`);\r\n\r\n      return reject(error);\r\n    }\r\n\r\n    // TODO: load bulk data items that we might need\r\n    const mediaType = 'multipart/related; type=\"application/octet-stream\"'; // 'image/dicom+jp2';\r\n\r\n    // get the pixel data from the server\r\n    getPixelData(uri, imageId, mediaType).then((result) => {\r\n      const transferSyntax = getTransferSyntaxForContentType(result.contentType);\r\n      const pixelData = result.imageFrame.pixelData;\r\n      const imagePromise = createImage(imageId, pixelData, transferSyntax, options);\r\n\r\n      imagePromise.then((image) => {\r\n        // add the loadTimeInMS property\r\n        const end = new Date().getTime();\r\n\r\n        image.loadTimeInMS = end - start;\r\n        resolve(image);\r\n      }, reject);\r\n    }, reject).catch((error) => {\r\n      reject(error);\r\n    });\r\n  });\r\n\r\n  return {\r\n    promise,\r\n    cancelFn: undefined\r\n  };\r\n}\r\n\r\nexport default loadImage;\r\n","import { getNumberString,\r\n  getNumberValue,\r\n  getNumberValues,\r\n  getValue,\r\n  metaDataProvider } from './metaData/index.js';\r\n\r\nimport findIndexOfString from './findIndexOfString.js';\r\nimport getPixelData from './getPixelData.js';\r\nimport metaDataManager from './metaDataManager.js';\r\nimport loadImage from './loadImage.js';\r\nimport register from './register.js';\r\n\r\nconst metaData = {\r\n  getNumberString,\r\n  getNumberValue,\r\n  getNumberValues,\r\n  getValue,\r\n  metaDataProvider\r\n};\r\n\r\nexport default {\r\n  metaData,\r\n  findIndexOfString,\r\n  getPixelData,\r\n  loadImage,\r\n  metaDataManager,\r\n  register\r\n};\r\n","import loadImage from './loadImage.js';\r\nimport { metaDataProvider } from './metaData/index.js';\r\n\r\nexport default function (cornerstone) {\r\n  // register wadors scheme and metadata provider\r\n  cornerstone.registerImageLoader('wadors', loadImage);\r\n  cornerstone.metaData.addProvider(metaDataProvider);\r\n}\r\n","import wadors from './wadors/index.js';\r\nimport wadouri from './wadouri/index.js';\r\n\r\n/**\r\n * Register the WADO-URI and WADO-RS image loaders and metaData providers\r\n * with an instance of Cornerstone Core.\r\n *\r\n * @param cornerstone The Cornerstone Core library to register the image loaders with\r\n */\r\nfunction registerLoaders (cornerstone) {\r\n  wadors.register(cornerstone);\r\n  wadouri.register(cornerstone);\r\n}\r\n\r\nexport default registerLoaders;\r\n","/* eslint import/extensions:0 */\r\nimport registerLoaders from './imageLoader/registerLoaders.js';\r\n\r\nlet cornerstone;\r\nlet dicomParser;\r\n\r\nconst external = {\r\n  set cornerstone (cs) {\r\n    cornerstone = cs;\r\n\r\n    registerLoaders(cornerstone);\r\n  },\r\n  get cornerstone () {\r\n    if (!cornerstone) {\r\n      if (window && window.cornerstone) {\r\n        cornerstone = window.cornerstone;\r\n\r\n        registerLoaders(cornerstone);\r\n      } else {\r\n        throw new Error('cornerstoneWADOImageLoader requires a copy of Cornerstone to work properly. Please add cornerstoneWADOImageLoader.external.cornerstone = cornerstone; to your application.');\r\n      }\r\n    }\r\n\r\n    return cornerstone;\r\n  },\r\n  set dicomParser (dp) {\r\n    dicomParser = dp;\r\n  },\r\n  get dicomParser () {\r\n    if (!dicomParser) {\r\n      if (window && window.dicomParser) {\r\n        dicomParser = window.dicomParser;\r\n      } else {\r\n        throw new Error('cornerstoneWADOImageLoader requires a copy of dicomParser to work properly. Please add cornerstoneWADOImageLoader.external.dicomParser = dicomParser; to your application.');\r\n      }\r\n    }\r\n\r\n    return dicomParser;\r\n  }\r\n};\r\n\r\nexport default external;\r\n","function parseImageId (imageId) {\r\n  // build a url by parsing out the url scheme and frame index from the imageId\r\n  const firstColonIndex = imageId.indexOf(':');\r\n  let url = imageId.substring(firstColonIndex + 1);\r\n  const frameIndex = url.indexOf('frame=');\r\n  let frame;\r\n\r\n  if (frameIndex !== -1) {\r\n    const frameStr = url.substr(frameIndex + 6);\r\n\r\n    frame = parseInt(frameStr, 10);\r\n    url = url.substr(0, frameIndex - 1);\r\n  }\r\n\r\n  return {\r\n    scheme: imageId.substr(0, firstColonIndex),\r\n    url,\r\n    frame\r\n  };\r\n}\r\n\r\nexport default parseImageId;\r\n","import external from '../../externalModules.js';\r\nimport { xhrRequest } from '../internal/index.js';\r\n\r\n/**\r\n * This object supports loading of DICOM P10 dataset from a uri and caching it so it can be accessed\r\n * by the caller.  This allows a caller to access the datasets without having to go through cornerstone's\r\n * image loader mechanism.  One reason a caller may need to do this is to determine the number of frames\r\n * in a multiframe sop instance so it can create the imageId's correctly.\r\n */\r\nlet cacheSizeInBytes = 0;\r\n\r\nlet loadedDataSets = {};\r\nlet promises = {};\r\n\r\n// returns true if the wadouri for the specified index has been loaded\r\nfunction isLoaded (uri) {\r\n  return loadedDataSets[uri] !== undefined;\r\n}\r\n\r\nfunction get (uri) {\r\n  if (!loadedDataSets[uri]) {\r\n    return;\r\n  }\r\n\r\n  return loadedDataSets[uri].dataSet;\r\n}\r\n\r\n\r\n// loads the dicom dataset from the wadouri sp\r\nfunction load (uri, loadRequest = xhrRequest, imageId) {\r\n  const { cornerstone, dicomParser } = external;\r\n\r\n  // if already loaded return it right away\r\n  if (loadedDataSets[uri]) {\r\n    // console.log('using loaded dataset ' + uri);\r\n    return new Promise((resolve) => {\r\n      loadedDataSets[uri].cacheCount++;\r\n      resolve(loadedDataSets[uri].dataSet);\r\n    });\r\n  }\r\n\r\n  // if we are currently loading this uri, increment the cacheCount and return its promise\r\n  if (promises[uri]) {\r\n    // console.log('returning existing load promise for ' + uri);\r\n    promises[uri].cacheCount++;\r\n\r\n    return promises[uri];\r\n  }\r\n\r\n  // This uri is not loaded or being loaded, load it via an xhrRequest\r\n  const loadDICOMPromise = loadRequest(uri, imageId);\r\n\r\n  // handle success and failure of the XHR request load\r\n  const promise = new Promise((resolve, reject) => {\r\n    loadDICOMPromise.then(function (dicomPart10AsArrayBuffer/* , xhr*/) {\r\n      const byteArray = new Uint8Array(dicomPart10AsArrayBuffer);\r\n\r\n      // Reject the promise if parsing the dicom file fails\r\n      let dataSet;\r\n\r\n      try {\r\n        dataSet = dicomParser.parseDicom(byteArray);\r\n      } catch (error) {\r\n        return reject(error);\r\n      }\r\n\r\n      loadedDataSets[uri] = {\r\n        dataSet,\r\n        cacheCount: promise.cacheCount\r\n      };\r\n      cacheSizeInBytes += dataSet.byteArray.length;\r\n      resolve(dataSet);\r\n\r\n      cornerstone.triggerEvent(cornerstone.events, 'datasetscachechanged', {\r\n        uri,\r\n        action: 'loaded',\r\n        cacheInfo: getInfo()\r\n      });\r\n    }, reject).then(() => {\r\n      // Remove the promise if success\r\n      delete promises[uri];\r\n    }, () => {\r\n      // Remove the promise if failure\r\n      delete promises[uri];\r\n    });\r\n  });\r\n\r\n  promise.cacheCount = 1;\r\n\r\n  promises[uri] = promise;\r\n\r\n  return promise;\r\n}\r\n\r\n// remove the cached/loaded dicom dataset for the specified wadouri to free up memory\r\nfunction unload (uri) {\r\n  const { cornerstone } = external;\r\n\r\n  // console.log('unload for ' + uri);\r\n  if (loadedDataSets[uri]) {\r\n    loadedDataSets[uri].cacheCount--;\r\n    if (loadedDataSets[uri].cacheCount === 0) {\r\n      // console.log('removing loaded dataset for ' + uri);\r\n      cacheSizeInBytes -= loadedDataSets[uri].dataSet.byteArray.length;\r\n      delete loadedDataSets[uri];\r\n\r\n      cornerstone.triggerEvent(cornerstone.events, 'datasetscachechanged', {\r\n        uri,\r\n        action: 'unloaded',\r\n        cacheInfo: getInfo()\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nexport function getInfo () {\r\n  return {\r\n    cacheSizeInBytes,\r\n    numberOfDataSetsCached: Object.keys(loadedDataSets).length\r\n  };\r\n}\r\n\r\n// removes all cached datasets from memory\r\nfunction purge () {\r\n  loadedDataSets = {};\r\n  promises = {};\r\n}\r\n\r\nexport default {\r\n  isLoaded,\r\n  load,\r\n  unload,\r\n  getInfo,\r\n  purge,\r\n  get\r\n};\r\n","import external from '../../../externalModules.js';\r\nimport getNumberValues from './getNumberValues.js';\r\nimport parseImageId from '../parseImageId.js';\r\nimport dataSetCacheManager from '../dataSetCacheManager.js';\r\nimport getImagePixelModule from './getImagePixelModule.js';\r\nimport getLUTs from './getLUTs.js';\r\nimport getModalityLUTOutputPixelRepresentation from './getModalityLUTOutputPixelRepresentation.js';\r\n\r\nfunction metaDataProvider (type, imageId) {\r\n  const { dicomParser } = external;\r\n  const parsedImageId = parseImageId(imageId);\r\n\r\n  const dataSet = dataSetCacheManager.get(parsedImageId.url);\r\n\r\n  if (!dataSet) {\r\n    return;\r\n  }\r\n\r\n  if (type === 'generalSeriesModule') {\r\n    return {\r\n      modality: dataSet.string('x00080060'),\r\n      seriesInstanceUID: dataSet.string('x0020000e'),\r\n      seriesNumber: dataSet.intString('x00200011'),\r\n      studyInstanceUID: dataSet.string('x0020000d'),\r\n      seriesDate: dicomParser.parseDA(dataSet.string('x00080021')),\r\n      seriesTime: dicomParser.parseTM(dataSet.string('x00080031') || '')\r\n    };\r\n  }\r\n\r\n  if (type === 'patientStudyModule') {\r\n    return {\r\n      patientAge: dataSet.intString('x00101010'),\r\n      patientSize: dataSet.floatString('x00101020'),\r\n      patientWeight: dataSet.floatString('x00101030')\r\n    };\r\n  }\r\n\r\n  if (type === 'imagePlaneModule') {\r\n\r\n    const imageOrientationPatient = getNumberValues(dataSet, 'x00200037', 6);\r\n    const imagePositionPatient = getNumberValues(dataSet, 'x00200032', 3);\r\n    const pixelSpacing = getNumberValues(dataSet, 'x00280030', 2);\r\n    let columnPixelSpacing = null;\r\n    let rowPixelSpacing = null;\r\n\r\n    if (pixelSpacing) {\r\n      rowPixelSpacing = pixelSpacing[0];\r\n      columnPixelSpacing = pixelSpacing[1];\r\n    }\r\n\r\n    let rowCosines = null;\r\n    let columnCosines = null;\r\n\r\n    if (imageOrientationPatient) {\r\n      rowCosines = [parseFloat(imageOrientationPatient[0]), parseFloat(imageOrientationPatient[1]), parseFloat(imageOrientationPatient[2])];\r\n      columnCosines = [parseFloat(imageOrientationPatient[3]), parseFloat(imageOrientationPatient[4]), parseFloat(imageOrientationPatient[5])];\r\n    }\r\n\r\n    return {\r\n      frameOfReferenceUID: dataSet.string('x00200052'),\r\n      rows: dataSet.uint16('x00280010'),\r\n      columns: dataSet.uint16('x00280011'),\r\n      imageOrientationPatient,\r\n      rowCosines,\r\n      columnCosines,\r\n      imagePositionPatient,\r\n      sliceThickness: dataSet.floatString('x00180050'),\r\n      sliceLocation: dataSet.floatString('x00201041'),\r\n      pixelSpacing,\r\n      rowPixelSpacing,\r\n      columnPixelSpacing\r\n    };\r\n  }\r\n\r\n  if (type === 'imagePixelModule') {\r\n    return getImagePixelModule(dataSet);\r\n  }\r\n\r\n  if (type === 'modalityLutModule') {\r\n    return {\r\n      rescaleIntercept: dataSet.floatString('x00281052'),\r\n      rescaleSlope: dataSet.floatString('x00281053'),\r\n      rescaleType: dataSet.string('x00281054'),\r\n      modalityLUTSequence: getLUTs(dataSet.uint16('x00280103'), dataSet.elements.x00283000)\r\n    };\r\n  }\r\n\r\n  if (type === 'voiLutModule') {\r\n    const modalityLUTOutputPixelRepresentation = getModalityLUTOutputPixelRepresentation(dataSet);\r\n\r\n\r\n    return {\r\n      windowCenter: getNumberValues(dataSet, 'x00281050', 1),\r\n      windowWidth: getNumberValues(dataSet, 'x00281051', 1),\r\n      voiLUTSequence: getLUTs(modalityLUTOutputPixelRepresentation, dataSet.elements.x00283010)\r\n    };\r\n  }\r\n\r\n  if (type === 'sopCommonModule') {\r\n    return {\r\n      sopClassUID: dataSet.string('x00080016'),\r\n      sopInstanceUID: dataSet.string('x00080018')\r\n    };\r\n  }\r\n\r\n  if (type === 'petIsotopeModule') {\r\n    const radiopharmaceuticalInfo = dataSet.elements.x00540016;\r\n\r\n    if (radiopharmaceuticalInfo === undefined) {\r\n      return;\r\n    }\r\n\r\n    const firstRadiopharmaceuticalInfoDataSet = radiopharmaceuticalInfo.items[0].dataSet;\r\n\r\n\r\n    return {\r\n      radiopharmaceuticalInfo: {\r\n        radiopharmaceuticalStartTime: dicomParser.parseTM(firstRadiopharmaceuticalInfoDataSet.string('x00181072') || ''),\r\n        radionuclideTotalDose: firstRadiopharmaceuticalInfoDataSet.floatString('x00181074'),\r\n        radionuclideHalfLife: firstRadiopharmaceuticalInfoDataSet.floatString('x00181075')\r\n      }\r\n    };\r\n  }\r\n}\r\n\r\nexport default metaDataProvider;\r\n","let files = [];\r\n\r\nfunction add (file) {\r\n  const fileIndex = files.push(file);\r\n\r\n  return `dicomfile:${fileIndex - 1}`;\r\n}\r\n\r\nfunction get (index) {\r\n  return files[index];\r\n}\r\n\r\nfunction remove (index) {\r\n  files[index] = undefined;\r\n}\r\n\r\nfunction purge () {\r\n  files = [];\r\n}\r\n\r\nexport default {\r\n  add,\r\n  get,\r\n  remove,\r\n  purge\r\n};\r\n","import external from '../../externalModules.js';\r\n\r\n/**\r\n * Function to deal with extracting an image frame from an encapsulated data set.\r\n */\r\n\r\n\r\nfunction framesAreFragmented (dataSet) {\r\n  const numberOfFrames = dataSet.intString('x00280008');\r\n  const pixelDataElement = dataSet.elements.x7fe00010;\r\n\r\n  return (numberOfFrames !== pixelDataElement.fragments.length);\r\n}\r\n\r\nexport default function getEncapsulatedImageFrame (dataSet, frameIndex) {\r\n  const { dicomParser } = external;\r\n\r\n  if (dataSet.elements.x7fe00010 && dataSet.elements.x7fe00010.basicOffsetTable.length) {\r\n    // Basic Offset Table is not empty\r\n    return dicomParser.readEncapsulatedImageFrame(dataSet, dataSet.elements.x7fe00010, frameIndex);\r\n  }\r\n\r\n  // Empty basic offset table\r\n\r\n  if (framesAreFragmented(dataSet)) {\r\n    const basicOffsetTable = dicomParser.createJPEGBasicOffsetTable(dataSet, dataSet.elements.x7fe00010);\r\n\r\n    return dicomParser.readEncapsulatedImageFrame(dataSet, dataSet.elements.x7fe00010, frameIndex, basicOffsetTable);\r\n  }\r\n\r\n  return dicomParser.readEncapsulatedPixelDataFromFragments(dataSet, dataSet.elements.x7fe00010, frameIndex);\r\n}\r\n","/* eslint no-bitwise: 0 */\r\n\r\nfunction isBitSet (byte, bitPos) {\r\n  return byte & (1 << bitPos);\r\n}\r\n\r\n/**\r\n * Function to deal with unpacking a binary frame\r\n */\r\nfunction unpackBinaryFrame (byteArray, frameOffset, pixelsPerFrame) {\r\n  // Create a new pixel array given the image size\r\n  const pixelData = new Uint8Array(pixelsPerFrame);\r\n\r\n  for (let i = 0; i < pixelsPerFrame; i++) {\r\n    // Compute byte position\r\n    const bytePos = Math.floor(i / 8);\r\n\r\n    // Get the current byte\r\n    const byte = byteArray[bytePos + frameOffset];\r\n\r\n    // Bit position (0-7) within byte\r\n    const bitPos = (i % 8);\r\n\r\n    // Check whether bit at bitpos is set\r\n    pixelData[i] = isBitSet(byte, bitPos) ? 1 : 0;\r\n  }\r\n\r\n  return pixelData;\r\n}\r\n\r\nexport default unpackBinaryFrame;\r\n","import unpackBinaryFrame from './unpackBinaryFrame.js';\r\n\r\n/**\r\n * Function to deal with extracting an image frame from an encapsulated data set.\r\n */\r\n\r\nfunction getUncompressedImageFrame (dataSet, frameIndex) {\r\n  const pixelDataElement = dataSet.elements.x7fe00010 || dataSet.elements.x7fe00008;\r\n  const bitsAllocated = dataSet.uint16('x00280100');\r\n  const rows = dataSet.uint16('x00280010');\r\n  const columns = dataSet.uint16('x00280011');\r\n  const samplesPerPixel = dataSet.uint16('x00280002');\r\n\r\n  const pixelDataOffset = pixelDataElement.dataOffset;\r\n  const pixelsPerFrame = rows * columns * samplesPerPixel;\r\n\r\n  let frameOffset;\r\n\r\n  if (bitsAllocated === 8) {\r\n    frameOffset = pixelDataOffset + frameIndex * pixelsPerFrame;\r\n    if (frameOffset >= dataSet.byteArray.length) {\r\n      throw new Error('frame exceeds size of pixelData');\r\n    }\r\n\r\n    return new Uint8Array(dataSet.byteArray.buffer, frameOffset, pixelsPerFrame);\r\n  } else if (bitsAllocated === 16) {\r\n    frameOffset = pixelDataOffset + frameIndex * pixelsPerFrame * 2;\r\n    if (frameOffset >= dataSet.byteArray.length) {\r\n      throw new Error('frame exceeds size of pixelData');\r\n    }\r\n\r\n    return new Uint8Array(dataSet.byteArray.buffer, frameOffset, pixelsPerFrame * 2);\r\n  } else if (bitsAllocated === 1) {\r\n    frameOffset = pixelDataOffset + frameIndex * pixelsPerFrame * 0.125;\r\n    if (frameOffset >= dataSet.byteArray.length) {\r\n      throw new Error('frame exceeds size of pixelData');\r\n    }\r\n\r\n    return unpackBinaryFrame(dataSet.byteArray, frameOffset, pixelsPerFrame);\r\n  } else if (bitsAllocated === 32) {\r\n    frameOffset = pixelDataOffset + frameIndex * pixelsPerFrame * 4;\r\n    if (frameOffset >= dataSet.byteArray.length) {\r\n      throw new Error('frame exceeds size of pixelData');\r\n    }\r\n\r\n    return new Uint8Array(dataSet.byteArray.buffer, frameOffset, pixelsPerFrame * 4);\r\n  }\r\n\r\n  throw new Error('unsupported pixel format');\r\n}\r\n\r\nexport default getUncompressedImageFrame;\r\n","import parseImageId from './parseImageId.js';\r\nimport fileManager from './fileManager.js';\r\n\r\nfunction loadFileRequest (uri) {\r\n  const parsedImageId = parseImageId(uri);\r\n  const fileIndex = parseInt(parsedImageId.url, 10);\r\n  const file = fileManager.get(fileIndex);\r\n\r\n  return new Promise((resolve, reject) => {\r\n    const fileReader = new FileReader();\r\n\r\n    fileReader.onload = (e) => {\r\n      const dicomPart10AsArrayBuffer = e.target.result;\r\n\r\n      resolve(dicomPart10AsArrayBuffer);\r\n    };\r\n\r\n    fileReader.onerror = reject;\r\n\r\n    fileReader.readAsArrayBuffer(file);\r\n  });\r\n}\r\n\r\nexport default loadFileRequest;\r\n","import getEncapsulatedImageFrame from './getEncapsulatedImageFrame.js';\r\nimport getUncompressedImageFrame from './getUncompressedImageFrame.js';\r\n\r\nfunction getPixelData (dataSet, frameIndex = 0) {\r\n  const pixelDataElement = dataSet.elements.x7fe00010 || dataSet.elements.x7fe00008;\r\n\r\n  if (!pixelDataElement) {\r\n    return null;\r\n  }\r\n\r\n  if (pixelDataElement.encapsulatedPixelData) {\r\n    return getEncapsulatedImageFrame(dataSet, frameIndex);\r\n  }\r\n\r\n  return getUncompressedImageFrame(dataSet, frameIndex);\r\n}\r\n\r\nexport default getPixelData;\r\n","import createImage from '../createImage.js';\r\nimport parseImageId from './parseImageId.js';\r\nimport dataSetCacheManager from './dataSetCacheManager.js';\r\nimport loadFileRequest from './loadFileRequest.js';\r\nimport getPixelData from './getPixelData.js';\r\nimport { xhrRequest } from '../internal/index.js';\r\n\r\n// add a decache callback function to clear out our dataSetCacheManager\r\nfunction addDecache (imageLoadObject, imageId) {\r\n  imageLoadObject.decache = function () {\r\n    // console.log('decache');\r\n    const parsedImageId = parseImageId(imageId);\r\n\r\n    dataSetCacheManager.unload(parsedImageId.url);\r\n  };\r\n}\r\n\r\nfunction loadImageFromPromise (dataSetPromise, imageId, frame = 0, sharedCacheKey, options, callbacks) {\r\n  const start = new Date().getTime();\r\n  const imageLoadObject = {\r\n    cancelFn: undefined\r\n  };\r\n\r\n  imageLoadObject.promise = new Promise((resolve, reject) => {\r\n    dataSetPromise.then((dataSet/* , xhr*/) => {\r\n      const pixelData = getPixelData(dataSet, frame);\r\n      const transferSyntax = dataSet.string('x00020010');\r\n      const loadEnd = new Date().getTime();\r\n      const imagePromise = createImage(imageId, pixelData, transferSyntax, options);\r\n\r\n      addDecache(imageLoadObject, imageId);\r\n\r\n      imagePromise.then((image) => {\r\n        image.data = dataSet;\r\n        image.sharedCacheKey = sharedCacheKey;\r\n        const end = new Date().getTime();\r\n\r\n        image.loadTimeInMS = loadEnd - start;\r\n        image.totalTimeInMS = end - start;\r\n        if (callbacks !== undefined && callbacks.imageDoneCallback !== undefined) {\r\n          callbacks.imageDoneCallback(image);\r\n        }\r\n        resolve(image);\r\n      }, function (error) {\r\n        // Reject the error, and the dataSet\r\n        reject({\r\n          error,\r\n          dataSet\r\n        });\r\n      });\r\n    }, function (error) {\r\n      // Reject the error\r\n      reject({\r\n        error\r\n      });\r\n    });\r\n  });\r\n\r\n  return imageLoadObject;\r\n}\r\n\r\nfunction loadImageFromDataSet (dataSet, imageId, frame = 0, sharedCacheKey, options) {\r\n  const start = new Date().getTime();\r\n\r\n  const promise = new Promise((resolve, reject) => {\r\n    const loadEnd = new Date().getTime();\r\n    let imagePromise;\r\n\r\n    try {\r\n      const pixelData = getPixelData(dataSet, frame);\r\n      const transferSyntax = dataSet.string('x00020010');\r\n\r\n      imagePromise = createImage(imageId, pixelData, transferSyntax, options);\r\n    } catch (error) {\r\n      // Reject the error, and the dataSet\r\n      reject({\r\n        error,\r\n        dataSet\r\n      });\r\n\r\n      return;\r\n    }\r\n\r\n    imagePromise.then((image) => {\r\n      image.data = dataSet;\r\n      image.sharedCacheKey = sharedCacheKey;\r\n      const end = new Date().getTime();\r\n\r\n      image.loadTimeInMS = loadEnd - start;\r\n      image.totalTimeInMS = end - start;\r\n      resolve(image);\r\n    }, reject);\r\n  });\r\n\r\n  return {\r\n    promise,\r\n    cancelFn: undefined\r\n  };\r\n}\r\n\r\nfunction getLoaderForScheme (scheme) {\r\n  if (scheme === 'dicomweb' || scheme === 'wadouri') {\r\n    return xhrRequest;\r\n  } else if (scheme === 'dicomfile') {\r\n    return loadFileRequest;\r\n  }\r\n}\r\n\r\nfunction loadImage (imageId, options = {}) {\r\n  const parsedImageId = parseImageId(imageId);\r\n\r\n  options = Object.assign({}, options);\r\n  let loader = options.loader;\r\n\r\n  if (loader === undefined) {\r\n    loader = getLoaderForScheme(parsedImageId.scheme);\r\n  } else {\r\n    delete options.loader;\r\n  }\r\n\r\n  // if the dataset for this url is already loaded, use it\r\n  if (dataSetCacheManager.isLoaded(parsedImageId.url)) {\r\n    const dataSet = dataSetCacheManager.get(parsedImageId.url, loader, imageId);\r\n\r\n    return loadImageFromDataSet(dataSet, imageId, parsedImageId.frame, parsedImageId.url, options);\r\n  }\r\n\r\n  // load the dataSet via the dataSetCacheManager\r\n  const dataSetPromise = dataSetCacheManager.load(parsedImageId.url, loader, imageId);\r\n\r\n  return loadImageFromPromise(dataSetPromise, imageId, parsedImageId.frame, parsedImageId.url, options);\r\n}\r\n\r\nexport { loadImageFromPromise, getLoaderForScheme, loadImage };\r\n","import { loadImage } from './loadImage.js';\r\nimport { metaDataProvider } from './metaData/index.js';\r\n\r\nexport default function (cornerstone) {\r\n  // register dicomweb and wadouri image loader prefixes\r\n  cornerstone.registerImageLoader('dicomweb', loadImage);\r\n  cornerstone.registerImageLoader('wadouri', loadImage);\r\n  cornerstone.registerImageLoader('dicomfile', loadImage);\r\n\r\n  // add wadouri metadata provider\r\n  cornerstone.metaData.addProvider(metaDataProvider);\r\n}\r\n","import { getImagePixelModule,\r\n  getLUTs,\r\n  getModalityLUTOutputPixelRepresentation,\r\n  getNumberValues,\r\n  metaDataProvider } from './metaData/index.js';\r\n\r\nimport dataSetCacheManager from './dataSetCacheManager.js';\r\nimport fileManager from './fileManager.js';\r\nimport getEncapsulatedImageFrame from './getEncapsulatedImageFrame.js';\r\nimport getUncompressedImageFrame from './getUncompressedImageFrame.js';\r\nimport loadFileRequest from './loadFileRequest.js';\r\nimport { loadImageFromPromise,\r\n  getLoaderForScheme,\r\n  loadImage } from './loadImage.js';\r\nimport parseImageId from './parseImageId.js';\r\nimport unpackBinaryFrame from './unpackBinaryFrame.js';\r\nimport register from './register.js';\r\n\r\nconst metaData = {\r\n  getImagePixelModule,\r\n  getLUTs,\r\n  getModalityLUTOutputPixelRepresentation,\r\n  getNumberValues,\r\n  metaDataProvider\r\n};\r\n\r\nexport default {\r\n  metaData,\r\n  dataSetCacheManager,\r\n  fileManager,\r\n  getEncapsulatedImageFrame,\r\n  getUncompressedImageFrame,\r\n  loadFileRequest,\r\n  loadImageFromPromise,\r\n  getLoaderForScheme,\r\n  loadImage,\r\n  parseImageId,\r\n  unpackBinaryFrame,\r\n  register\r\n};\r\n","import { setOptions } from './internal/index.js';\r\n\r\nfunction configure (options) {\r\n  setOptions(options);\r\n}\r\n\r\nexport default configure;\r\n","import {\r\n  convertRGBColorByPixel,\r\n  convertRGBColorByPlane,\r\n  convertYBRFullByPixel,\r\n  convertYBRFullByPlane,\r\n  convertPALETTECOLOR\r\n} from './colorSpaceConverters/index.js';\r\n\r\nimport { default as wadouri } from './wadouri/index.js';\r\nimport { default as wadors } from './wadors/index.js';\r\nimport { default as configure } from './configure.js';\r\nimport { default as convertColorSpace } from './convertColorSpace.js';\r\nimport { default as createImage } from './createImage.js';\r\nimport { default as decodeImageFrame } from './decodeImageFrame.js';\r\nimport { default as decodeJPEGBaseline8BitColor } from './decodeJPEGBaseline8BitColor.js';\r\nimport { default as getImageFrame } from './getImageFrame.js';\r\nimport { default as getMinMax } from '../shared/getMinMax.js';\r\nimport { default as isColorImage } from './isColorImage.js';\r\nimport { default as isJPEGBaseline8BitColor } from './isJPEGBaseline8BitColor.js';\r\nimport { default as webWorkerManager } from './webWorkerManager.js';\r\nimport { default as version } from '../version.js';\r\nimport { internal } from './internal/index.js';\r\nimport { default as external } from '../externalModules.js';\r\n\r\nconst cornerstoneWADOImageLoader = {\r\n  convertRGBColorByPixel,\r\n  convertRGBColorByPlane,\r\n  convertYBRFullByPixel,\r\n  convertYBRFullByPlane,\r\n  convertPALETTECOLOR,\r\n  wadouri,\r\n  wadors,\r\n  configure,\r\n  convertColorSpace,\r\n  createImage,\r\n  decodeImageFrame,\r\n  decodeJPEGBaseline8BitColor,\r\n  getImageFrame,\r\n  getMinMax,\r\n  isColorImage,\r\n  isJPEGBaseline8BitColor,\r\n  webWorkerManager,\r\n  version,\r\n  internal,\r\n  external\r\n};\r\n\r\nexport {\r\n  convertRGBColorByPixel,\r\n  convertRGBColorByPlane,\r\n  convertYBRFullByPixel,\r\n  convertYBRFullByPlane,\r\n  convertPALETTECOLOR,\r\n  wadouri,\r\n  wadors,\r\n  configure,\r\n  convertColorSpace,\r\n  createImage,\r\n  decodeImageFrame,\r\n  decodeJPEGBaseline8BitColor,\r\n  getImageFrame,\r\n  getMinMax,\r\n  isColorImage,\r\n  isJPEGBaseline8BitColor,\r\n  webWorkerManager,\r\n  version,\r\n  internal,\r\n  external\r\n};\r\n\r\nexport default cornerstoneWADOImageLoader;\r\n"],"sourceRoot":""}