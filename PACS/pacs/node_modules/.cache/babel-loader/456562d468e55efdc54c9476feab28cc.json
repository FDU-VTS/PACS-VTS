{"ast":null,"code":"import _extends from 'babel-runtime/helpers/extends';\nimport _defineProperty from 'babel-runtime/helpers/defineProperty';\nimport _objectWithoutProperties from 'babel-runtime/helpers/objectWithoutProperties';\nimport _classCallCheck from 'babel-runtime/helpers/classCallCheck';\nimport _createClass from 'babel-runtime/helpers/createClass';\nimport _possibleConstructorReturn from 'babel-runtime/helpers/possibleConstructorReturn';\nimport _inherits from 'babel-runtime/helpers/inherits';\n/* eslint react/no-is-mounted:0,react/sort-comp:0,react/prop-types:0 */\n\nimport React, { Component } from 'react';\nimport classNames from 'classnames';\nimport defaultRequest from './request';\nimport getUid from './uid';\nimport attrAccept from './attr-accept';\nimport traverseFileTree from './traverseFileTree';\n\nvar dataOrAriaAttributeProps = function dataOrAriaAttributeProps(props) {\n  return Object.keys(props).reduce(function (acc, key) {\n    if (key.substr(0, 5) === 'data-' || key.substr(0, 5) === 'aria-' || key === 'role') {\n      acc[key] = props[key];\n    }\n\n    return acc;\n  }, {});\n};\n\nvar AjaxUploader = function (_Component) {\n  _inherits(AjaxUploader, _Component);\n\n  function AjaxUploader() {\n    var _ref;\n\n    var _temp, _this, _ret;\n\n    _classCallCheck(this, AjaxUploader);\n\n    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return _ret = (_temp = (_this = _possibleConstructorReturn(this, (_ref = AjaxUploader.__proto__ || Object.getPrototypeOf(AjaxUploader)).call.apply(_ref, [this].concat(args))), _this), _this.state = {\n      uid: getUid()\n    }, _this.reqs = {}, _this.onChange = function (e) {\n      var files = e.target.files;\n\n      _this.uploadFiles(files);\n\n      _this.reset();\n    }, _this.onClick = function () {\n      var el = _this.fileInput;\n\n      if (!el) {\n        return;\n      }\n\n      var children = _this.props.children;\n\n      if (children && children.type === 'button') {\n        el.parentNode.focus();\n        el.parentNode.querySelector('button').blur();\n      }\n\n      el.click();\n    }, _this.onKeyDown = function (e) {\n      if (e.key === 'Enter') {\n        _this.onClick();\n      }\n    }, _this.onFileDrop = function (e) {\n      var multiple = _this.props.multiple;\n      e.preventDefault();\n\n      if (e.type === 'dragover') {\n        return;\n      }\n\n      if (_this.props.directory) {\n        traverseFileTree(e.dataTransfer.items, _this.uploadFiles, function (_file) {\n          return attrAccept(_file, _this.props.accept);\n        });\n      } else {\n        var files = Array.prototype.slice.call(e.dataTransfer.files).filter(function (file) {\n          return attrAccept(file, _this.props.accept);\n        });\n\n        if (multiple === false) {\n          files = files.slice(0, 1);\n        }\n\n        _this.uploadFiles(files);\n      }\n    }, _this.uploadFiles = function (files) {\n      var postFiles = Array.prototype.slice.call(files);\n      postFiles.map(function (file) {\n        file.uid = getUid();\n        return file;\n      }).forEach(function (file) {\n        _this.upload(file, postFiles);\n      });\n    }, _this.saveFileInput = function (node) {\n      _this.fileInput = node;\n    }, _temp), _possibleConstructorReturn(_this, _ret);\n  }\n\n  _createClass(AjaxUploader, [{\n    key: 'componentDidMount',\n    value: function componentDidMount() {\n      this._isMounted = true;\n    }\n  }, {\n    key: 'componentWillUnmount',\n    value: function componentWillUnmount() {\n      this._isMounted = false;\n      this.abort();\n    }\n  }, {\n    key: 'upload',\n    value: function upload(file, fileList) {\n      var _this2 = this;\n\n      var props = this.props;\n\n      if (!props.beforeUpload) {\n        // always async in case use react state to keep fileList\n        return setTimeout(function () {\n          return _this2.post(file);\n        }, 0);\n      }\n\n      var before = props.beforeUpload(file, fileList);\n\n      if (before && before.then) {\n        before.then(function (processedFile) {\n          var processedFileType = Object.prototype.toString.call(processedFile);\n\n          if (processedFileType === '[object File]' || processedFileType === '[object Blob]') {\n            return _this2.post(processedFile);\n          }\n\n          return _this2.post(file);\n        })['catch'](function (e) {\n          console && console.log(e); // eslint-disable-line\n        });\n      } else if (before !== false) {\n        setTimeout(function () {\n          return _this2.post(file);\n        }, 0);\n      }\n    }\n  }, {\n    key: 'post',\n    value: function post(file) {\n      var _this3 = this;\n\n      if (!this._isMounted) {\n        return;\n      }\n\n      var props = this.props;\n      var data = props.data;\n      var onStart = props.onStart,\n          onProgress = props.onProgress,\n          _props$transformFile = props.transformFile,\n          transformFile = _props$transformFile === undefined ? function (originFile) {\n        return originFile;\n      } : _props$transformFile;\n      new Promise(function (resolve) {\n        var action = props.action;\n\n        if (typeof action === 'function') {\n          return resolve(action(file));\n        }\n\n        resolve(action);\n      }).then(function (action) {\n        var uid = file.uid;\n        var request = props.customRequest || defaultRequest;\n        var transform = Promise.resolve(transformFile(file))['catch'](function (e) {\n          console.error(e); // eslint-disable-line no-console\n        });\n        transform.then(function (transformedFile) {\n          if (typeof data === 'function') {\n            data = data(file);\n          }\n\n          var requestOption = {\n            action: action,\n            filename: props.name,\n            data: data,\n            file: transformedFile,\n            headers: props.headers,\n            withCredentials: props.withCredentials,\n            method: props.method || 'post',\n            onProgress: onProgress ? function (e) {\n              onProgress(e, file);\n            } : null,\n            onSuccess: function onSuccess(ret, xhr) {\n              delete _this3.reqs[uid];\n              props.onSuccess(ret, file, xhr);\n            },\n            onError: function onError(err, ret) {\n              delete _this3.reqs[uid];\n              props.onError(err, ret, file);\n            }\n          };\n          _this3.reqs[uid] = request(requestOption);\n          onStart(file);\n        });\n      });\n    }\n  }, {\n    key: 'reset',\n    value: function reset() {\n      this.setState({\n        uid: getUid()\n      });\n    }\n  }, {\n    key: 'abort',\n    value: function abort(file) {\n      var reqs = this.reqs;\n\n      if (file) {\n        var uid = file;\n\n        if (file && file.uid) {\n          uid = file.uid;\n        }\n\n        if (reqs[uid] && reqs[uid].abort) {\n          reqs[uid].abort();\n        }\n\n        delete reqs[uid];\n      } else {\n        Object.keys(reqs).forEach(function (uid) {\n          if (reqs[uid] && reqs[uid].abort) {\n            reqs[uid].abort();\n          }\n\n          delete reqs[uid];\n        });\n      }\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var _classNames;\n\n      var _props = this.props,\n          Tag = _props.component,\n          prefixCls = _props.prefixCls,\n          className = _props.className,\n          disabled = _props.disabled,\n          id = _props.id,\n          style = _props.style,\n          multiple = _props.multiple,\n          accept = _props.accept,\n          children = _props.children,\n          directory = _props.directory,\n          openFileDialogOnClick = _props.openFileDialogOnClick,\n          otherProps = _objectWithoutProperties(_props, ['component', 'prefixCls', 'className', 'disabled', 'id', 'style', 'multiple', 'accept', 'children', 'directory', 'openFileDialogOnClick']);\n\n      var cls = classNames((_classNames = {}, _defineProperty(_classNames, prefixCls, true), _defineProperty(_classNames, prefixCls + '-disabled', disabled), _defineProperty(_classNames, className, className), _classNames));\n      var events = disabled ? {} : {\n        onClick: openFileDialogOnClick ? this.onClick : function () {},\n        onKeyDown: openFileDialogOnClick ? this.onKeyDown : function () {},\n        onDrop: this.onFileDrop,\n        onDragOver: this.onFileDrop,\n        tabIndex: '0'\n      };\n      return React.createElement(Tag, _extends({}, events, {\n        className: cls,\n        role: 'button',\n        style: style\n      }), React.createElement('input', _extends({}, dataOrAriaAttributeProps(otherProps), {\n        id: id,\n        type: 'file',\n        ref: this.saveFileInput,\n        onClick: function onClick(e) {\n          return e.stopPropagation();\n        } // https://github.com/ant-design/ant-design/issues/19948\n        ,\n        key: this.state.uid,\n        style: {\n          display: 'none'\n        },\n        accept: accept,\n        directory: directory ? 'directory' : null,\n        webkitdirectory: directory ? 'webkitdirectory' : null,\n        multiple: multiple,\n        onChange: this.onChange\n      })), children);\n    }\n  }]);\n\n  return AjaxUploader;\n}(Component);\n\nexport default AjaxUploader;","map":{"version":3,"sources":["/Users/bly/Documents/工作/实验室/项目/医疗系统/PACS-VTS/PACS-VTS/PACS/pacs/node_modules/rc-upload/es/AjaxUploader.js"],"names":["_extends","_defineProperty","_objectWithoutProperties","_classCallCheck","_createClass","_possibleConstructorReturn","_inherits","React","Component","classNames","defaultRequest","getUid","attrAccept","traverseFileTree","dataOrAriaAttributeProps","props","Object","keys","reduce","acc","key","substr","AjaxUploader","_Component","_ref","_temp","_this","_ret","_len","arguments","length","args","Array","_key","__proto__","getPrototypeOf","call","apply","concat","state","uid","reqs","onChange","e","files","target","uploadFiles","reset","onClick","el","fileInput","children","type","parentNode","focus","querySelector","blur","click","onKeyDown","onFileDrop","multiple","preventDefault","directory","dataTransfer","items","_file","accept","prototype","slice","filter","file","postFiles","map","forEach","upload","saveFileInput","node","value","componentDidMount","_isMounted","componentWillUnmount","abort","fileList","_this2","beforeUpload","setTimeout","post","before","then","processedFile","processedFileType","toString","console","log","_this3","data","onStart","onProgress","_props$transformFile","transformFile","undefined","originFile","Promise","resolve","action","request","customRequest","transform","error","transformedFile","requestOption","filename","name","headers","withCredentials","method","onSuccess","ret","xhr","onError","err","setState","render","_classNames","_props","Tag","component","prefixCls","className","disabled","id","style","openFileDialogOnClick","otherProps","cls","events","onDrop","onDragOver","tabIndex","createElement","role","ref","stopPropagation","display","webkitdirectory"],"mappings":"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","sourcesContent":["import _extends from 'babel-runtime/helpers/extends';\nimport _defineProperty from 'babel-runtime/helpers/defineProperty';\nimport _objectWithoutProperties from 'babel-runtime/helpers/objectWithoutProperties';\nimport _classCallCheck from 'babel-runtime/helpers/classCallCheck';\nimport _createClass from 'babel-runtime/helpers/createClass';\nimport _possibleConstructorReturn from 'babel-runtime/helpers/possibleConstructorReturn';\nimport _inherits from 'babel-runtime/helpers/inherits';\n/* eslint react/no-is-mounted:0,react/sort-comp:0,react/prop-types:0 */\nimport React, { Component } from 'react';\nimport classNames from 'classnames';\nimport defaultRequest from './request';\nimport getUid from './uid';\nimport attrAccept from './attr-accept';\nimport traverseFileTree from './traverseFileTree';\n\nvar dataOrAriaAttributeProps = function dataOrAriaAttributeProps(props) {\n  return Object.keys(props).reduce(function (acc, key) {\n    if (key.substr(0, 5) === 'data-' || key.substr(0, 5) === 'aria-' || key === 'role') {\n      acc[key] = props[key];\n    }\n    return acc;\n  }, {});\n};\n\nvar AjaxUploader = function (_Component) {\n  _inherits(AjaxUploader, _Component);\n\n  function AjaxUploader() {\n    var _ref;\n\n    var _temp, _this, _ret;\n\n    _classCallCheck(this, AjaxUploader);\n\n    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return _ret = (_temp = (_this = _possibleConstructorReturn(this, (_ref = AjaxUploader.__proto__ || Object.getPrototypeOf(AjaxUploader)).call.apply(_ref, [this].concat(args))), _this), _this.state = { uid: getUid() }, _this.reqs = {}, _this.onChange = function (e) {\n      var files = e.target.files;\n      _this.uploadFiles(files);\n      _this.reset();\n    }, _this.onClick = function () {\n      var el = _this.fileInput;\n      if (!el) {\n        return;\n      }\n      var children = _this.props.children;\n\n      if (children && children.type === 'button') {\n        el.parentNode.focus();\n        el.parentNode.querySelector('button').blur();\n      }\n      el.click();\n    }, _this.onKeyDown = function (e) {\n      if (e.key === 'Enter') {\n        _this.onClick();\n      }\n    }, _this.onFileDrop = function (e) {\n      var multiple = _this.props.multiple;\n\n\n      e.preventDefault();\n\n      if (e.type === 'dragover') {\n        return;\n      }\n\n      if (_this.props.directory) {\n        traverseFileTree(e.dataTransfer.items, _this.uploadFiles, function (_file) {\n          return attrAccept(_file, _this.props.accept);\n        });\n      } else {\n        var files = Array.prototype.slice.call(e.dataTransfer.files).filter(function (file) {\n          return attrAccept(file, _this.props.accept);\n        });\n\n        if (multiple === false) {\n          files = files.slice(0, 1);\n        }\n\n        _this.uploadFiles(files);\n      }\n    }, _this.uploadFiles = function (files) {\n      var postFiles = Array.prototype.slice.call(files);\n      postFiles.map(function (file) {\n        file.uid = getUid();\n        return file;\n      }).forEach(function (file) {\n        _this.upload(file, postFiles);\n      });\n    }, _this.saveFileInput = function (node) {\n      _this.fileInput = node;\n    }, _temp), _possibleConstructorReturn(_this, _ret);\n  }\n\n  _createClass(AjaxUploader, [{\n    key: 'componentDidMount',\n    value: function componentDidMount() {\n      this._isMounted = true;\n    }\n  }, {\n    key: 'componentWillUnmount',\n    value: function componentWillUnmount() {\n      this._isMounted = false;\n      this.abort();\n    }\n  }, {\n    key: 'upload',\n    value: function upload(file, fileList) {\n      var _this2 = this;\n\n      var props = this.props;\n\n      if (!props.beforeUpload) {\n        // always async in case use react state to keep fileList\n        return setTimeout(function () {\n          return _this2.post(file);\n        }, 0);\n      }\n\n      var before = props.beforeUpload(file, fileList);\n      if (before && before.then) {\n        before.then(function (processedFile) {\n          var processedFileType = Object.prototype.toString.call(processedFile);\n          if (processedFileType === '[object File]' || processedFileType === '[object Blob]') {\n            return _this2.post(processedFile);\n          }\n          return _this2.post(file);\n        })['catch'](function (e) {\n          console && console.log(e); // eslint-disable-line\n        });\n      } else if (before !== false) {\n        setTimeout(function () {\n          return _this2.post(file);\n        }, 0);\n      }\n    }\n  }, {\n    key: 'post',\n    value: function post(file) {\n      var _this3 = this;\n\n      if (!this._isMounted) {\n        return;\n      }\n      var props = this.props;\n      var data = props.data;\n      var onStart = props.onStart,\n          onProgress = props.onProgress,\n          _props$transformFile = props.transformFile,\n          transformFile = _props$transformFile === undefined ? function (originFile) {\n        return originFile;\n      } : _props$transformFile;\n\n\n      new Promise(function (resolve) {\n        var action = props.action;\n\n        if (typeof action === 'function') {\n          return resolve(action(file));\n        }\n        resolve(action);\n      }).then(function (action) {\n        var uid = file.uid;\n\n        var request = props.customRequest || defaultRequest;\n        var transform = Promise.resolve(transformFile(file))['catch'](function (e) {\n          console.error(e); // eslint-disable-line no-console\n        });\n\n        transform.then(function (transformedFile) {\n          if (typeof data === 'function') {\n            data = data(file);\n          }\n\n          var requestOption = {\n            action: action,\n            filename: props.name,\n            data: data,\n            file: transformedFile,\n            headers: props.headers,\n            withCredentials: props.withCredentials,\n            method: props.method || 'post',\n            onProgress: onProgress ? function (e) {\n              onProgress(e, file);\n            } : null,\n            onSuccess: function onSuccess(ret, xhr) {\n              delete _this3.reqs[uid];\n              props.onSuccess(ret, file, xhr);\n            },\n            onError: function onError(err, ret) {\n              delete _this3.reqs[uid];\n              props.onError(err, ret, file);\n            }\n          };\n          _this3.reqs[uid] = request(requestOption);\n          onStart(file);\n        });\n      });\n    }\n  }, {\n    key: 'reset',\n    value: function reset() {\n      this.setState({\n        uid: getUid()\n      });\n    }\n  }, {\n    key: 'abort',\n    value: function abort(file) {\n      var reqs = this.reqs;\n\n      if (file) {\n        var uid = file;\n        if (file && file.uid) {\n          uid = file.uid;\n        }\n        if (reqs[uid] && reqs[uid].abort) {\n          reqs[uid].abort();\n        }\n        delete reqs[uid];\n      } else {\n        Object.keys(reqs).forEach(function (uid) {\n          if (reqs[uid] && reqs[uid].abort) {\n            reqs[uid].abort();\n          }\n          delete reqs[uid];\n        });\n      }\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var _classNames;\n\n      var _props = this.props,\n          Tag = _props.component,\n          prefixCls = _props.prefixCls,\n          className = _props.className,\n          disabled = _props.disabled,\n          id = _props.id,\n          style = _props.style,\n          multiple = _props.multiple,\n          accept = _props.accept,\n          children = _props.children,\n          directory = _props.directory,\n          openFileDialogOnClick = _props.openFileDialogOnClick,\n          otherProps = _objectWithoutProperties(_props, ['component', 'prefixCls', 'className', 'disabled', 'id', 'style', 'multiple', 'accept', 'children', 'directory', 'openFileDialogOnClick']);\n\n      var cls = classNames((_classNames = {}, _defineProperty(_classNames, prefixCls, true), _defineProperty(_classNames, prefixCls + '-disabled', disabled), _defineProperty(_classNames, className, className), _classNames));\n      var events = disabled ? {} : {\n        onClick: openFileDialogOnClick ? this.onClick : function () {},\n        onKeyDown: openFileDialogOnClick ? this.onKeyDown : function () {},\n        onDrop: this.onFileDrop,\n        onDragOver: this.onFileDrop,\n        tabIndex: '0'\n      };\n      return React.createElement(\n        Tag,\n        _extends({}, events, {\n          className: cls,\n          role: 'button',\n          style: style\n        }),\n        React.createElement('input', _extends({}, dataOrAriaAttributeProps(otherProps), {\n          id: id,\n          type: 'file',\n          ref: this.saveFileInput,\n          onClick: function onClick(e) {\n            return e.stopPropagation();\n          } // https://github.com/ant-design/ant-design/issues/19948\n          , key: this.state.uid,\n          style: { display: 'none' },\n          accept: accept,\n          directory: directory ? 'directory' : null,\n          webkitdirectory: directory ? 'webkitdirectory' : null,\n          multiple: multiple,\n          onChange: this.onChange\n        })),\n        children\n      );\n    }\n  }]);\n\n  return AjaxUploader;\n}(Component);\n\nexport default AjaxUploader;"]},"metadata":{},"sourceType":"module"}