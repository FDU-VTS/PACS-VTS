{"ast":null,"code":"function _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && Symbol.iterator in Object(iter)) return Array.from(iter);\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nimport * as React from 'react';\nimport { getColumnPos, renderColumnTitle, getColumnKey } from '../../util';\nimport FilterDropdown from './FilterDropdown';\n\nfunction collectFilterStates(columns, init, pos) {\n  var filterStates = [];\n  (columns || []).forEach(function (column, index) {\n    var columnPos = getColumnPos(index, pos);\n\n    if ('children' in column) {\n      filterStates = [].concat(_toConsumableArray(filterStates), _toConsumableArray(collectFilterStates(column.children, init, columnPos)));\n    } else if (column.filters || 'filterDropdown' in column || 'onFilter' in column) {\n      if ('filteredValue' in column) {\n        // Controlled\n        filterStates.push({\n          column: column,\n          key: getColumnKey(column, columnPos),\n          filteredKeys: column.filteredValue,\n          forceFiltered: column.filtered\n        });\n      } else {\n        // Uncontrolled\n        filterStates.push({\n          column: column,\n          key: getColumnKey(column, columnPos),\n          filteredKeys: init && column.defaultFilteredValue ? column.defaultFilteredValue : undefined,\n          forceFiltered: column.filtered\n        });\n      }\n    }\n  });\n  return filterStates;\n}\n\nfunction injectFilter(prefixCls, dropdownPrefixCls, columns, filterStates, triggerFilter, getPopupContainer, locale, pos) {\n  return columns.map(function (column, index) {\n    var columnPos = getColumnPos(index, pos);\n    var _column$filterMultipl = column.filterMultiple,\n        filterMultiple = _column$filterMultipl === void 0 ? true : _column$filterMultipl;\n\n    if (column.filters || 'filterDropdown' in column) {\n      var columnKey = getColumnKey(column, columnPos);\n      var filterState = filterStates.find(function (_ref) {\n        var key = _ref.key;\n        return columnKey === key;\n      });\n      return _extends(_extends({}, column), {\n        title: function title(renderProps) {\n          return /*#__PURE__*/React.createElement(FilterDropdown, {\n            prefixCls: \"\".concat(prefixCls, \"-filter\"),\n            dropdownPrefixCls: dropdownPrefixCls,\n            column: column,\n            columnKey: columnKey,\n            filterState: filterState,\n            filterMultiple: filterMultiple,\n            triggerFilter: triggerFilter,\n            locale: locale,\n            getPopupContainer: getPopupContainer\n          }, renderColumnTitle(column.title, renderProps));\n        }\n      });\n    }\n\n    if ('children' in column) {\n      return _extends(_extends({}, column), {\n        children: injectFilter(prefixCls, dropdownPrefixCls, column.children, filterStates, triggerFilter, getPopupContainer, locale, columnPos)\n      });\n    }\n\n    return column;\n  });\n}\n\nfunction generateFilterInfo(filterStates) {\n  var currentFilters = {};\n  filterStates.forEach(function (_ref2) {\n    var key = _ref2.key,\n        filteredKeys = _ref2.filteredKeys;\n    currentFilters[key] = filteredKeys || null;\n  });\n  return currentFilters;\n}\n\nfunction flattenKeys(filters) {\n  var keys = [];\n  (filters || []).forEach(function (_ref3) {\n    var value = _ref3.value,\n        children = _ref3.children;\n    keys.push(value);\n\n    if (children) {\n      keys = [].concat(_toConsumableArray(keys), _toConsumableArray(flattenKeys(children)));\n    }\n  });\n  return keys;\n}\n\nexport function getFilterData(data, filterStates) {\n  return filterStates.reduce(function (currentData, filterState) {\n    var _filterState$column = filterState.column,\n        onFilter = _filterState$column.onFilter,\n        filters = _filterState$column.filters,\n        filteredKeys = filterState.filteredKeys;\n\n    if (onFilter && filteredKeys && filteredKeys.length) {\n      return currentData.filter(function (record) {\n        return filteredKeys.some(function (key) {\n          var keys = flattenKeys(filters);\n          var keyIndex = keys.findIndex(function (k) {\n            return String(k) === String(key);\n          });\n          var realKey = keyIndex !== -1 ? keys[keyIndex] : key;\n          return onFilter(realKey, record);\n        });\n      });\n    }\n\n    return currentData;\n  }, data);\n}\n\nfunction useFilter(_ref4) {\n  var prefixCls = _ref4.prefixCls,\n      dropdownPrefixCls = _ref4.dropdownPrefixCls,\n      mergedColumns = _ref4.mergedColumns,\n      onFilterChange = _ref4.onFilterChange,\n      getPopupContainer = _ref4.getPopupContainer,\n      tableLocale = _ref4.locale;\n\n  var _React$useState = React.useState(collectFilterStates(mergedColumns, true)),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      filterStates = _React$useState2[0],\n      setFilterStates = _React$useState2[1];\n\n  var mergedFilterStates = React.useMemo(function () {\n    var collectedStates = collectFilterStates(mergedColumns, false); // Return if not controlled\n\n    if (collectedStates.every(function (_ref5) {\n      var filteredKeys = _ref5.filteredKeys;\n      return filteredKeys === undefined;\n    })) {\n      return filterStates;\n    }\n\n    return collectedStates;\n  }, [mergedColumns, filterStates]);\n  var getFilters = React.useCallback(function () {\n    return generateFilterInfo(mergedFilterStates);\n  }, [mergedFilterStates]);\n\n  var triggerFilter = function triggerFilter(filterState) {\n    var newFilterStates = mergedFilterStates.filter(function (_ref6) {\n      var key = _ref6.key;\n      return key !== filterState.key;\n    });\n    newFilterStates.push(filterState);\n    setFilterStates(newFilterStates);\n    onFilterChange(generateFilterInfo(newFilterStates), newFilterStates);\n  };\n\n  var transformColumns = function transformColumns(innerColumns) {\n    return injectFilter(prefixCls, dropdownPrefixCls, innerColumns, mergedFilterStates, triggerFilter, getPopupContainer, tableLocale);\n  };\n\n  return [transformColumns, mergedFilterStates, getFilters];\n}\n\nexport default useFilter;","map":{"version":3,"sources":["/Users/bly/Documents/工作/实验室/项目/医疗系统/PACS-VTS/PACS/pacs/node_modules/antd/es/table/hooks/useFilter/index.js"],"names":["_slicedToArray","arr","i","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","TypeError","Symbol","iterator","Object","_arr","_n","_d","_e","undefined","_i","_s","next","done","push","value","length","err","Array","isArray","_extends","assign","target","arguments","source","key","prototype","hasOwnProperty","call","apply","_toConsumableArray","_arrayWithoutHoles","_iterableToArray","_nonIterableSpread","o","minLen","_arrayLikeToArray","n","toString","slice","constructor","name","from","test","iter","len","arr2","React","getColumnPos","renderColumnTitle","getColumnKey","FilterDropdown","collectFilterStates","columns","init","pos","filterStates","forEach","column","index","columnPos","concat","children","filters","filteredKeys","filteredValue","forceFiltered","filtered","defaultFilteredValue","injectFilter","prefixCls","dropdownPrefixCls","triggerFilter","getPopupContainer","locale","map","_column$filterMultipl","filterMultiple","columnKey","filterState","find","_ref","title","renderProps","createElement","generateFilterInfo","currentFilters","_ref2","flattenKeys","keys","_ref3","getFilterData","data","reduce","currentData","_filterState$column","onFilter","filter","record","some","keyIndex","findIndex","k","String","realKey","useFilter","_ref4","mergedColumns","onFilterChange","tableLocale","_React$useState","useState","_React$useState2","setFilterStates","mergedFilterStates","useMemo","collectedStates","every","_ref5","getFilters","useCallback","newFilterStates","_ref6","transformColumns","innerColumns"],"mappings":"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","sourcesContent":["function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _iterableToArrayLimit(arr, i) { if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _iterableToArray(iter) { if (typeof Symbol !== \"undefined\" && Symbol.iterator in Object(iter)) return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nimport * as React from 'react';\nimport { getColumnPos, renderColumnTitle, getColumnKey } from '../../util';\nimport FilterDropdown from './FilterDropdown';\n\nfunction collectFilterStates(columns, init, pos) {\n  var filterStates = [];\n  (columns || []).forEach(function (column, index) {\n    var columnPos = getColumnPos(index, pos);\n\n    if ('children' in column) {\n      filterStates = [].concat(_toConsumableArray(filterStates), _toConsumableArray(collectFilterStates(column.children, init, columnPos)));\n    } else if (column.filters || 'filterDropdown' in column || 'onFilter' in column) {\n      if ('filteredValue' in column) {\n        // Controlled\n        filterStates.push({\n          column: column,\n          key: getColumnKey(column, columnPos),\n          filteredKeys: column.filteredValue,\n          forceFiltered: column.filtered\n        });\n      } else {\n        // Uncontrolled\n        filterStates.push({\n          column: column,\n          key: getColumnKey(column, columnPos),\n          filteredKeys: init && column.defaultFilteredValue ? column.defaultFilteredValue : undefined,\n          forceFiltered: column.filtered\n        });\n      }\n    }\n  });\n  return filterStates;\n}\n\nfunction injectFilter(prefixCls, dropdownPrefixCls, columns, filterStates, triggerFilter, getPopupContainer, locale, pos) {\n  return columns.map(function (column, index) {\n    var columnPos = getColumnPos(index, pos);\n    var _column$filterMultipl = column.filterMultiple,\n        filterMultiple = _column$filterMultipl === void 0 ? true : _column$filterMultipl;\n\n    if (column.filters || 'filterDropdown' in column) {\n      var columnKey = getColumnKey(column, columnPos);\n      var filterState = filterStates.find(function (_ref) {\n        var key = _ref.key;\n        return columnKey === key;\n      });\n      return _extends(_extends({}, column), {\n        title: function title(renderProps) {\n          return /*#__PURE__*/React.createElement(FilterDropdown, {\n            prefixCls: \"\".concat(prefixCls, \"-filter\"),\n            dropdownPrefixCls: dropdownPrefixCls,\n            column: column,\n            columnKey: columnKey,\n            filterState: filterState,\n            filterMultiple: filterMultiple,\n            triggerFilter: triggerFilter,\n            locale: locale,\n            getPopupContainer: getPopupContainer\n          }, renderColumnTitle(column.title, renderProps));\n        }\n      });\n    }\n\n    if ('children' in column) {\n      return _extends(_extends({}, column), {\n        children: injectFilter(prefixCls, dropdownPrefixCls, column.children, filterStates, triggerFilter, getPopupContainer, locale, columnPos)\n      });\n    }\n\n    return column;\n  });\n}\n\nfunction generateFilterInfo(filterStates) {\n  var currentFilters = {};\n  filterStates.forEach(function (_ref2) {\n    var key = _ref2.key,\n        filteredKeys = _ref2.filteredKeys;\n    currentFilters[key] = filteredKeys || null;\n  });\n  return currentFilters;\n}\n\nfunction flattenKeys(filters) {\n  var keys = [];\n  (filters || []).forEach(function (_ref3) {\n    var value = _ref3.value,\n        children = _ref3.children;\n    keys.push(value);\n\n    if (children) {\n      keys = [].concat(_toConsumableArray(keys), _toConsumableArray(flattenKeys(children)));\n    }\n  });\n  return keys;\n}\n\nexport function getFilterData(data, filterStates) {\n  return filterStates.reduce(function (currentData, filterState) {\n    var _filterState$column = filterState.column,\n        onFilter = _filterState$column.onFilter,\n        filters = _filterState$column.filters,\n        filteredKeys = filterState.filteredKeys;\n\n    if (onFilter && filteredKeys && filteredKeys.length) {\n      return currentData.filter(function (record) {\n        return filteredKeys.some(function (key) {\n          var keys = flattenKeys(filters);\n          var keyIndex = keys.findIndex(function (k) {\n            return String(k) === String(key);\n          });\n          var realKey = keyIndex !== -1 ? keys[keyIndex] : key;\n          return onFilter(realKey, record);\n        });\n      });\n    }\n\n    return currentData;\n  }, data);\n}\n\nfunction useFilter(_ref4) {\n  var prefixCls = _ref4.prefixCls,\n      dropdownPrefixCls = _ref4.dropdownPrefixCls,\n      mergedColumns = _ref4.mergedColumns,\n      onFilterChange = _ref4.onFilterChange,\n      getPopupContainer = _ref4.getPopupContainer,\n      tableLocale = _ref4.locale;\n\n  var _React$useState = React.useState(collectFilterStates(mergedColumns, true)),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      filterStates = _React$useState2[0],\n      setFilterStates = _React$useState2[1];\n\n  var mergedFilterStates = React.useMemo(function () {\n    var collectedStates = collectFilterStates(mergedColumns, false); // Return if not controlled\n\n    if (collectedStates.every(function (_ref5) {\n      var filteredKeys = _ref5.filteredKeys;\n      return filteredKeys === undefined;\n    })) {\n      return filterStates;\n    }\n\n    return collectedStates;\n  }, [mergedColumns, filterStates]);\n  var getFilters = React.useCallback(function () {\n    return generateFilterInfo(mergedFilterStates);\n  }, [mergedFilterStates]);\n\n  var triggerFilter = function triggerFilter(filterState) {\n    var newFilterStates = mergedFilterStates.filter(function (_ref6) {\n      var key = _ref6.key;\n      return key !== filterState.key;\n    });\n    newFilterStates.push(filterState);\n    setFilterStates(newFilterStates);\n    onFilterChange(generateFilterInfo(newFilterStates), newFilterStates);\n  };\n\n  var transformColumns = function transformColumns(innerColumns) {\n    return injectFilter(prefixCls, dropdownPrefixCls, innerColumns, mergedFilterStates, triggerFilter, getPopupContainer, tableLocale);\n  };\n\n  return [transformColumns, mergedFilterStates, getFilters];\n}\n\nexport default useFilter;"]},"metadata":{},"sourceType":"module"}